<!-- Place ce script dans ton index.html (avant </body>) pour gÃ©rer register/login basiques -->
<script>
const API_BASE = "http://localhost:4000/api";

async function register(email, password, name) {
  const r = await fetch(API_BASE + '/auth/register', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ email, password, name })
  });
  const json = await r.json();
  if (!r.ok) throw new Error(json.error || JSON.stringify(json));
  localStorage.setItem('nesti_token', json.token);
  return json.user;
}

async function login(email, password) {
  const r = await fetch(API_BASE + '/auth/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ email, password })
  });
  const json = await r.json();
  if (!r.ok) throw new Error(json.error || JSON.stringify(json));
  localStorage.setItem('nesti_token', json.token);
  return json.user;
}

function authFetch(path, opts = {}) {
  const token = localStorage.getItem('nesti_token');
  opts.headers = opts.headers || {};
  opts.headers['Content-Type'] = 'application/json';
  if (token) opts.headers['Authorization'] = 'Bearer ' + token;
  return fetch(API_BASE + path, opts).then(async r => {
    const body = await r.json().catch(()=>null);
    return { ok: r.ok, status: r.status, body };
  });
}

/* Exemple d'utilisation :
register('alex@example.com','motdepasse','Alex')
  .then(u => console.log('registered', u))
  .catch(e => alert(e.message));

login('alex@example.com','motdepasse')
  .then(u => console.log('logged', u))
  .catch(e => alert(e.message));
*/
</script>
