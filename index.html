<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nesti - Organisation familiale</title>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }
        
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #fdeef9 50%, #e6f0ff 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }
        
        .nesti-gradient {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 50%, #14b8a6 100%);
        }
        
        .meditation-active {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .message-bubble {
            max-width: 70%;
            border-radius: 18px;
            padding: 12px 16px;
            margin: 8px 0;
            line-height: 1.4;
        }
        
        .user-message {
            background: linear-gradient(135deg, #3b82f6 0%, #0ea5e9 100%);
            color: white;
            margin-left: auto;
        }
        
        .bot-message {
            background: #f8fafc;
            color: #334155;
            margin-right: auto;
            border: 1px solid #e2e8f0;
        }
        
        .event-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #06b6d4;
            position: absolute;
            bottom: 2px;
            right: 2px;
        }
        
        .calendar-day {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
        }
        
        .task-priority-high {
            border-left: 4px solid #ef4444;
        }
        
        .task-priority-medium {
            border-left: 4px solid #f59e0b;
        }
        
        .task-priority-low {
            border-left: 4px solid #10b981;
        }
        
        /* Animation pour les messages du bot */
        .typing-dots {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #06b6d4;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        /* Scrollbar personnalisée */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="container max-w-7xl mx-auto">
        <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
            <!-- Application Container -->
            <div id="app" class="flex flex-col md:flex-row min-h-screen">
                <!-- Sidebar Navigation -->
                <div class="w-full md:w-80 bg-white/50 p-6 md:p-8 flex flex-col">
                    <div class="flex items-center space-x-3 mb-8 md:mb-12">
                        <div class="w-12 h-12 nesti-gradient rounded-2xl flex items-center justify-center shadow-lg">
                            <div class="w-8 h-6 bg-white/90 rounded-lg flex items-center justify-center">
                                <div class="w-4 h-3 bg-gradient-to-br from-cyan-600 to-teal-600 rounded-sm"></div>
                            </div>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800 tracking-tight">Nesti</h1>
                    </div>

                    <nav class="space-y-2 mb-8">
                        <button data-view="dashboard" class="nav-btn w-full flex items-center space-x-4 px-4 py-4 rounded-2xl font-medium bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 shadow-sm">
                            <i class="fas fa-home w-5 h-5"></i>
                            <span>Dashboard</span>
                        </button>
                        <button data-view="chat" class="nav-btn w-full flex items-center space-x-4 px-4 py-4 rounded-2xl font-medium text-gray-600 hover:bg-white/60 hover:text-gray-800">
                            <i class="fas fa-comment-dots w-5 h-5"></i>
                            <span>Chat</span>
                        </button>
                        <button data-view="calendar" class="nav-btn w-full flex items-center space-x-4 px-4 py-4 rounded-2xl font-medium text-gray-600 hover:bg-white/60 hover:text-gray-800">
                            <i class="fas fa-calendar w-5 h-5"></i>
                            <span>Calendrier</span>
                        </button>
                        <button data-view="activities" class="nav-btn w-full flex items-center space-x-4 px-4 py-4 rounded-2xl font-medium text-gray-600 hover:bg-white/60 hover:text-gray-800">
                            <i class="fas fa-star w-5 h-5"></i>
                            <span>Activités</span>
                        </button>
                        <button data-view="settings" class="nav-btn w-full flex items-center space-x-4 px-4 py-4 rounded-2xl font-medium text-gray-600 hover:bg-white/60 hover:text-gray-800">
                            <i class="fas fa-cog w-5 h-5"></i>
                            <span>Paramètres</span>
                        </button>
                    </nav>

                    <!-- User Profile -->
                    <div class="bg-white/60 rounded-2xl p-4 mt-auto">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 nesti-gradient rounded-xl flex items-center justify-center text-white font-bold">
                                M
                            </div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-800 text-sm">Marie</p>
                                <p class="text-gray-600 text-xs">Famille Martin</p>
                            </div>
                        </div>
                        <button id="logout-btn" class="w-full flex items-center justify-center space-x-2 text-gray-600 hover:text-red-600 text-sm py-2">
                            <i class="fas fa-sign-out-alt w-4 h-4"></i>
                            <span>Déconnexion</span>
                        </button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="flex-1 p-6 md:p-8">
                    <!-- Header -->
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div class="mb-4 md:mb-0">
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Bonjour, Marie</h2>
                            <p class="text-gray-600 text-lg">Organisation et bien-être pour toute la famille</p>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <button class="relative p-3 bg-white/60 rounded-2xl shadow-sm hover:shadow-md">
                                <i class="fas fa-bell text-gray-600"></i>
                                <div class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">2</div>
                            </button>
                            
                            <div class="w-12 h-12 md:w-16 md:h-16 nesti-gradient rounded-2xl flex items-center justify-center shadow-lg">
                                <div class="w-10 h-10 md:w-12 md:h-12 bg-white rounded-xl flex items-center justify-center text-teal-600 font-bold text-lg">M</div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard View -->
                    <div id="dashboard-view" class="view-content">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                            <!-- Column 1: Schedule -->
                            <div class="space-y-6">
                                <div class="glass-card p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-xl font-bold text-gray-800">Emploi du temps</h3>
                                        <div class="flex space-x-2">
                                            <button id="add-event-btn" class="p-2 bg-teal-100 text-teal-600 rounded-xl hover:bg-teal-200">
                                                <i class="fas fa-plus w-4 h-4"></i>
                                            </button>
                                            <i class="fas fa-chevron-right w-5 h-5 text-gray-400"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- Mini Calendar -->
                                    <div class="mb-6">
                                        <div class="grid grid-cols-7 gap-1 text-center text-sm font-medium text-gray-500 mb-2">
                                            <div>L</div><div>M</div><div>M</div><div>J</div><div>V</div><div>S</div><div>D</div>
                                        </div>
                                        <div class="grid grid-cols-7 gap-1" id="mini-calendar">
                                            <!-- Calendar days will be generated here -->
                                        </div>
                                    </div>

                                    <!-- Today's Events -->
                                    <div class="space-y-3" id="today-events">
                                        <!-- Events will be populated here -->
                                    </div>
                                </div>

                                <!-- Tasks Section -->
                                <div class="glass-card p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-xl font-bold text-gray-800">Tâches</h3>
                                        <button id="add-task-btn" class="p-2 bg-teal-100 text-teal-600 rounded-xl hover:bg-teal-200">
                                            <i class="fas fa-plus w-4 h-4"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="space-y-3" id="tasks-list">
                                        <!-- Tasks will be populated here -->
                                    </div>
                                </div>

                                <!-- Inclusive Activities -->
                                <div class="glass-card p-6">
                                    <h3 class="text-xl font-bold text-gray-800 mb-4">Activités inclusives</h3>
                                    
                                    <div class="bg-gradient-to-br from-amber-100 to-orange-100 rounded-2xl p-4 hover:shadow-lg cursor-pointer">
                                        <div class="flex items-center space-x-3 mb-2">
                                            <div class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg">
                                                <span class="text-white text-lg">🎨</span>
                                            </div>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-gray-800">Expo sur l'art-thérapie</h4>
                                                <p class="text-sm text-gray-600 flex items-center">
                                                    <i class="fas fa-map-marker-alt w-3 h-3 mr-1"></i>
                                                    Musée de l'art moderne
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex space-x-2">
                                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">
                                                    Gratuit
                                                </span>
                                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                                                    6+
                                                </span>
                                            </div>
                                            <div class="flex items-center space-x-1">
                                                <i class="fas fa-star text-yellow-400 text-sm"></i>
                                                <span class="text-sm font-medium text-gray-700">4.8</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Column 2: Family Chat -->
                            <div class="glass-card p-6 flex flex-col">
                                <h3 class="text-xl font-bold text-gray-800 mb-6">Chat familial</h3>
                                
                                <div class="flex-1 space-y-4 mb-6 overflow-y-auto max-h-96" id="chat-messages">
                                    <!-- Messages will be populated here -->
                                </div>

                                <!-- Message Input -->
                                <div class="relative">
                                    <input type="text" id="message-input" placeholder="Écrire un message..." class="w-full bg-white/50 border border-white/30 rounded-2xl px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-teal-400">
                                    <button id="send-message-btn" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-8 h-8 nesti-gradient rounded-xl flex items-center justify-center text-white shadow-lg hover:shadow-xl">
                                        <i class="fas fa-paper-plane w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Column 3: Wellness -->
                            <div class="glass-card p-6 relative overflow-hidden">
                                <h3 class="text-xl font-bold text-gray-800 mb-6">Votre bien-être</h3>
                                
                                <div class="space-y-6">
                                    <div class="text-center">
                                        <p class="text-gray-700 mb-4 font-medium" id="meditation-status">N'oubliez pas votre pause méditation</p>
                                        
                                        <div id="meditation-timer" class="text-3xl font-bold text-teal-600 mb-4 hidden">0:00</div>
                                        
                                        <button id="meditation-toggle" class="font-bold py-3 px-8 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center space-x-2 mx-auto bg-gradient-to-r from-amber-400 to-orange-500 text-white">
                                            <i class="fas fa-play w-4 h-4"></i>
                                            <span>Démarrer</span>
                                        </button>
                                    </div>

                                    <!-- Wellness Avatar -->
                                    <div class="flex justify-center">
                                        <div class="relative">
                                            <div id="meditation-avatar" class="w-20 h-20 nesti-gradient rounded-3xl flex items-center justify-center shadow-xl">
                                                <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center">
                                                    <div class="w-12 h-12 bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Wellness Stats -->
                                    <div class="grid grid-cols-2 gap-3 mt-6">
                                        <div class="bg-white/40 rounded-xl p-3 text-center">
                                            <div class="text-2xl font-bold text-teal-600">7</div>
                                            <div class="text-xs text-gray-600">jours consécutifs</div>
                                        </div>
                                        <div class="bg-white/40 rounded-xl p-3 text-center">
                                            <div class="text-2xl font-bold text-purple-600">142</div>
                                            <div class="text-xs text-gray-600">min cette semaine</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Decorations -->
                                <div class="absolute -top-10 -right-10 w-32 h-32 bg-gradient-to-br from-purple-200/20 to-pink-200/20 rounded-full blur-xl"></div>
                                <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-gradient-to-br from-cyan-200/20 to-teal-200/20 rounded-full blur-xl"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Other views (initially hidden) -->
                    <div id="chat-view" class="view-content hidden">
                        <!-- Chat view content -->
                    </div>

                    <div id="calendar-view" class="view-content hidden">
                        <!-- Calendar view content -->
                    </div>

                    <div id="activities-view" class="view-content hidden">
                        <!-- Activities view content -->
                    </div>

                    <div id="settings-view" class="view-content hidden">
                        <!-- Settings view content -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-8 w-full max-w-md shadow-2xl border border-white/20">
            <div class="text-center mb-8">
                <div class="w-16 h-16 nesti-gradient rounded-2xl flex items-center justify-center shadow-lg mx-auto mb-4">
                    <div class="w-10 h-8 bg-white/90 rounded-lg flex items-center justify-center">
                        <div class="w-6 h-4 bg-gradient-to-br from-cyan-600 to-teal-600 rounded-sm"></div>
                    </div>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">Nesti</h1>
                <p class="text-gray-600" id="auth-subtitle">Connectez-vous à votre espace familial</p>
            </div>

            <form id="auth-form" class="space-y-4">
                <div id="name-fields" class="hidden space-y-4">
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="name-input" placeholder="Votre prénom" class="w-full bg-white/60 border border-white/30 rounded-xl px-12 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400">
                    </div>
                    <div class="relative">
                        <i class="fas fa-users absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="family-name-input" placeholder="Nom de famille" class="w-full bg-white/60 border border-white/30 rounded-xl px-12 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400">
                    </div>
                </div>
                
                <div class="relative">
                    <i class="fas fa-envelope absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="email" id="email-input" placeholder="Email" class="w-full bg-white/60 border border-white/30 rounded-xl px-12 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                </div>
                
                <div class="relative">
                    <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="password" id="password-input" placeholder="Mot de passe" class="w-full bg-white/60 border border-white/30 rounded-xl px-12 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                    <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                        <i class="fas fa-eye w-5 h-5"></i>
                    </button>
                </div>

                <button type="submit" class="w-full nesti-gradient text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 disabled:opacity-50 disabled:transform-none">
                    <span id="auth-button-text">Se connecter</span>
                </button>
            </form>

            <div class="mt-6 text-center">
                <button id="switch-auth-mode" class="text-teal-600 hover:text-teal-700 font-medium">
                    Pas encore d'espace familial ? Créer un compte
                </button>
            </div>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-6 w-full max-w-lg shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Nouvel événement</h3>
                <button id="close-event-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times w-6 h-6"></i>
                </button>
            </div>
            
            <form id="event-form" class="space-y-4">
                <input type="text" id="event-title" placeholder="Titre de l'événement" class="w-full bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                <textarea id="event-description" placeholder="Description" class="w-full bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400 h-20 resize-none"></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <input type="time" id="event-time" class="bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                    <input type="text" id="event-location" placeholder="Lieu" class="bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancel-event" class="flex-1 bg-gray-200 text-gray-700 font-medium py-3 rounded-xl hover:bg-gray-300">
                        Annuler
                    </button>
                    <button type="submit" class="flex-1 nesti-gradient text-white font-medium py-3 rounded-xl hover:from-teal-600 hover:to-cyan-700">
                        Ajouter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="task-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 hidden">
        <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-6 w-full max-w-lg shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Nouvelle tâche</h3>
                <button id="close-task-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times w-6 h-6"></i>
                </button>
            </div>
            
            <form id="task-form" class="space-y-4">
                <input type="text" id="task-title" placeholder="Titre de la tâche" class="w-full bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                <div class="grid grid-cols-2 gap-4">
                    <select id="task-assignee" class="bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400" required>
                        <option value="">Assigner à...</option>
                        <option value="Maman">Maman</option>
                        <option value="Papa">Papa</option>
                        <option value="Emma">Emma</option>
                    </select>
                    <select id="task-priority" class="bg-white/60 border border-white/30 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-400">
                        <option value="low">Faible</option>
                        <option value="medium">Moyenne</option>
                        <option value="high">Haute</option>
                    </select>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="button" id="cancel-task" class="flex-1 bg-gray-200 text-gray-700 font-medium py-3 rounded-xl hover:bg-gray-300">
                        Annuler
                    </button>
                    <button type="submit" class="flex-1 nesti-gradient text-white font-medium py-3 rounded-xl hover:from-teal-600 hover:to-cyan-700">
                        Ajouter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application State
        const state = {
            user: null,
            currentView: 'dashboard',
            isAuthenticated: false,
            currentTime: new Date(),
            showAuthModal: true,
            authMode: 'login',
            showPassword: false,
            events: [],
            tasks: [],
            messages: [],
            activities: [],
            notifications: [],
            showEventModal: false,
            showTaskModal: false,
            newMessage: '',
            selectedDate: new Date(),
            meditationActive: false,
            meditationTimer: 0,
            meditationInterval: null
        };

        // DOM Elements
        const elements = {
            app: document.getElementById('app'),
            authModal: document.getElementById('auth-modal'),
            authForm: document.getElementById('auth-form'),
            authSubtitle: document.getElementById('auth-subtitle'),
            authButtonText: document.getElementById('auth-button-text'),
            nameFields: document.getElementById('name-fields'),
            nameInput: document.getElementById('name-input'),
            familyNameInput: document.getElementById('family-name-input'),
            emailInput: document.getElementById('email-input'),
            passwordInput: document.getElementById('password-input'),
            togglePassword: document.getElementById('toggle-password'),
            switchAuthMode: document.getElementById('switch-auth-mode'),
            logoutBtn: document.getElementById('logout-btn'),
            navBtns: document.querySelectorAll('.nav-btn'),
            views: document.querySelectorAll('.view-content'),
            eventModal: document.getElementById('event-modal'),
            eventForm: document.getElementById('event-form'),
            closeEventModal: document.getElementById('close-event-modal'),
            addEventBtn: document.getElementById('add-event-btn'),
            cancelEvent: document.getElementById('cancel-event'),
            taskModal: document.getElementById('task-modal'),
            taskForm: document.getElementById('task-form'),
            closeTaskModal: document.getElementById('close-task-modal'),
            addTaskBtn: document.getElementById('add-task-btn'),
            cancelTask: document.getElementById('cancel-task'),
            messageInput: document.getElementById('message-input'),
            sendMessageBtn: document.getElementById('send-message-btn'),
            chatMessages: document.getElementById('chat-messages'),
            meditationToggle: document.getElementById('meditation-toggle'),
            meditationStatus: document.getElementById('meditation-status'),
            meditationTimer: document.getElementById('meditation-timer'),
            meditationAvatar: document.getElementById('meditation-avatar'),
            miniCalendar: document.getElementById('mini-calendar'),
            todayEvents: document.getElementById('today-events'),
            tasksList: document.getElementById('tasks-list')
        };

        // Initialize the application
        function init() {
            // Check if user is authenticated
            const savedUser = localStorage.getItem('nesti_user');
            if (savedUser) {
                state.user = JSON.parse(savedUser);
                state.isAuthenticated = true;
                state.showAuthModal = false;
                loadUserData();
            } else {
                state.showAuthModal = true;
            }

            // Set up event listeners
            setupEventListeners();

            // Update UI based on state
            updateUI();
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Auth modal
            elements.switchAuthMode.addEventListener('click', toggleAuthMode);
            elements.togglePassword.addEventListener('click', togglePasswordVisibility);
            elements.authForm.addEventListener('submit', handleAuth);
            elements.logoutBtn.addEventListener('click', logout);

            // Navigation
            elements.navBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const view = e.currentTarget.getAttribute('data-view');
                    switchView(view);
                });
            });

            // Event modal
            elements.addEventBtn.addEventListener('click', () => {
                state.showEventModal = true;
                updateUI();
            });
            elements.closeEventModal.addEventListener('click', closeEventModal);
            elements.cancelEvent.addEventListener('click', closeEventModal);
            elements.eventForm.addEventListener('submit', addEvent);

            // Task modal
            elements.addTaskBtn.addEventListener('click', () => {
                state.showTaskModal = true;
                updateUI();
            });
            elements.closeTaskModal.addEventListener('click', closeTaskModal);
            elements.cancelTask.addEventListener('click', closeTaskModal);
            elements.taskForm.addEventListener('submit', addTask);

            // Chat
            elements.sendMessageBtn.addEventListener('click', sendMessage);
            elements.messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });

            // Meditation
            elements.meditationToggle.addEventListener('click', toggleMeditation);
        }

        // Toggle between login and register modes
        function toggleAuthMode() {
            state.authMode = state.authMode === 'login' ? 'register' : 'login';
            updateUI();
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            state.showPassword = !state.showPassword;
            elements.passwordInput.type = state.showPassword ? 'text' : 'password';
            elements.togglePassword.innerHTML = state.showPassword ? 
                '<i class="fas fa-eye-slash w-5 h-5"></i>' : 
                '<i class="fas fa-eye w-5 h-5"></i>';
        }

        // Handle authentication
        function handleAuth(e) {
            e.preventDefault();
            
            if (state.authMode === 'login') {
                // Simple validation for demo
                if (elements.emailInput.value && elements.passwordInput.value) {
                    state.user = {
                        id: '1',
                        name: elements.emailInput.value.split('@')[0],
                        email: elements.emailInput.value,
                        familyName: 'Famille Martin',
                        avatar: 'M'
                    };
                    state.isAuthenticated = true;
                    state.showAuthModal = false;
                    
                    // Save to localStorage
                    localStorage.setItem('nesti_user', JSON.stringify(state.user));
                    
                    loadUserData();
                    updateUI();
                } else {
                    alert('Veuillez remplir tous les champs');
                }
            } else {
                // Registration
                if (elements.nameInput.value && elements.familyNameInput.value && 
                    elements.emailInput.value && elements.passwordInput.value) {
                    state.user = {
                        id: '1',
                        name: elements.nameInput.value,
                        email: elements.emailInput.value,
                        familyName: elements.familyNameInput.value,
                        avatar: elements.nameInput.value.charAt(0).toUpperCase()
                    };
                    state.isAuthenticated = true;
                    state.showAuthModal = false;
                    
                    // Save to localStorage
                    localStorage.setItem('nesti_user', JSON.stringify(state.user));
                    
                    loadUserData();
                    updateUI();
                } else {
                    alert('Veuillez remplir tous les champs');
                }
            }
        }

        // Logout user
        function logout() {
            state.user = null;
            state.isAuthenticated = false;
            state.showAuthModal = true;
            localStorage.removeItem('nesti_user');
            updateUI();
        }

        // Switch between views
        function switchView(view) {
            state.currentView = view;
            updateUI();
        }

        // Close event modal
        function closeEventModal() {
            state.showEventModal = false;
            updateUI();
        }

        // Close task modal
        function closeTaskModal() {
            state.showTaskModal = false;
            updateUI();
        }

        // Add new event
        function addEvent(e) {
            e.preventDefault();
            const newEvent = {
                id: Date.now().toString(),
                title: document.getElementById('event-title').value,
                description: document.getElementById('event-description').value,
                time: document.getElementById('event-time').value,
                location: document.getElementById('event-location').value,
                date: state.selectedDate,
                color: 'bg-purple-100',
                textColor: 'text-purple-800',
                icon: '📅'
            };
            state.events.push(newEvent);
            state.showEventModal = false;
            updateUI();
        }

        // Add new task
        function addTask(e) {
            e.preventDefault();
            const newTask = {
                id: Date.now().toString(),
                title: document.getElementById('task-title').value,
                assignee: document.getElementById('task-assignee').value,
                priority: document.getElementById('task-priority').value,
                completed: false,
                dueDate: state.selectedDate
            };
            state.tasks.push(newTask);
            state.showTaskModal = false;
            updateUI();
        }

        // Toggle task completion
        function toggleTask(taskId) {
            state.tasks = state.tasks.map(task => 
                task.id === taskId ? { ...task, completed: !task.completed } : task
            );
            updateUI();
        }

        // Send message
        function sendMessage() {
            const messageText = elements.messageInput.value.trim();
            if (!messageText) return;

            const userMessage = {
                id: Date.now().toString(),
                sender: state.user.name,
                content: messageText,
                timestamp: new Date(),
                type: 'user'
            };

            state.messages.push(userMessage);
            elements.messageInput.value = '';
            updateUI();
            
            // Scroll to bottom of chat
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            // Simulate bot response after a delay
            setTimeout(() => {
                const responses = [
                    "C'est une excellente idée ! Voulez-vous que je vous aide à organiser cela ?",
                    "J'ai trouvé quelques activités qui pourraient vous intéresser. Souhaitez-vous les voir ?",
                    "Parfait ! Je vais ajouter cela à votre planning familial.",
                    "Excellente question ! Laissez-moi vous proposer quelques suggestions personnalisées."
                ];
                
                const botMessage = {
                    id: (Date.now() + 1).toString(),
                    sender: 'Nesti',
                    content: responses[Math.floor(Math.random() * responses.length)],
                    timestamp: new Date(),
                    type: 'bot'
                };
                
                state.messages.push(botMessage);
                updateUI();
                
                // Scroll to bottom of chat again
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            }, 1500);
        }

        // Toggle meditation
        function toggleMeditation() {
            if (state.meditationActive) {
                // Stop meditation
                state.meditationActive = false;
                clearInterval(state.meditationInterval);
                elements.meditationAvatar.classList.remove('meditation-active');
            } else {
                // Start meditation
                state.meditationActive = true;
                state.meditationTimer = 0;
                elements.meditationAvatar.classList.add('meditation-active');
                
                state.meditationInterval = setInterval(() => {
                    state.meditationTimer++;
                    updateUI();
                }, 1000);
            }
            updateUI();
        }

        // Format time for meditation timer
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Load user data (simulated)
        function loadUserData() {
            // Simulate loading events
            state.events = [
                {
                    id: '1',
                    title: 'Heure du goûter',
                    time: '15:00',
                    date: new Date(),
                    color: 'bg-amber-100',
                    icon: '🍪',
                    textColor: 'text-amber-800',
                    description: 'Pause gourmande en famille'
                },
                {
                    id: '2',
                    title: 'Cours de piano',
                    time: '17:00',
                    date: new Date(),
                    color: 'bg-blue-100',
                    icon: '🎹',
                    textColor: 'text-blue-800',
                    description: 'Leçon de piano d\'Emma'
                },
                {
                    id: '3',
                    title: 'Jeux de famille',
                    time: '20:00',
                    date: new Date(),
                    color: 'bg-emerald-100',
                    icon: '🎲',
                    textColor: 'text-emerald-800',
                    description: 'Soirée jeux de société'
                }
            ];

            // Simulate loading tasks
            state.tasks = [
                {
                    id: '1',
                    title: 'Préparer le dîner',
                    completed: false,
                    assignee: 'Maman',
                    dueDate: new Date(),
                    priority: 'high'
                },
                {
                    id: '2',
                    title: 'Faire les devoirs',
                    completed: true,
                    assignee: 'Emma',
                    dueDate: new Date(),
                    priority: 'medium'
                },
                {
                    id: '3',
                    title: 'Acheter cadeau anniversaire',
                    completed: false,
                    assignee: 'Papa',
                    dueDate: new Date(Date.now() + 86400000),
                    priority: 'low'
                }
            ];

            // Simulate loading messages
            state.messages = [
                {
                    id: '1',
                    sender: 'Emma',
                    content: 'Salut à tous! Quelle activité ce soir?',
                    timestamp: new Date(Date.now() - 300000),
                    type: 'user'
                },
                {
                    id: '2',
                    sender: 'Nesti',
                    content: 'Bonjour! Je peux vous suggérer la dernière expo sur l\'art thérapie à 16h',
                    timestamp: new Date(Date.now() - 60000),
                    type: 'bot',
                    suggestions: ['En savoir plus', 'Réserver', 'Autres suggestions']
                }
            ];

            // Simulate loading activities
            state.activities = [
                {
                    id: '1',
                    title: 'Expo sur l\'art-thérapie',
                    location: 'Musée de l\'art moderne',
                    date: new Date(Date.now() + 86400000),
                    price: 'Gratuit',
                    accessibility: ['Accessible PMR', 'Audio-guide'],
                    rating: 4.8,
                    category: 'Culture',
                    ageRange: '6+'
                }
            ];

            // Simulate loading notifications
            state.notifications = [
                {
                    id: '1',
                    title: 'Rappel: Heure du goûter dans 30 min',
                    type: 'reminder',
                    timestamp: new Date(),
                    read: false
                }
            ];

            updateUI();
        }

        // Update UI based on application state
        function updateUI() {
            // Show/hide auth modal
            if (state.showAuthModal) {
                elements.authModal.classList.remove('hidden');
                elements.app.classList.add('blur-sm');
                
                // Update auth modal based on mode
                if (state.authMode === 'login') {
                    elements.authSubtitle.textContent = 'Connectez-vous à votre espace familial';
                    elements.authButtonText.textContent = 'Se connecter';
                    elements.nameFields.classList.add('hidden');
                    elements.switchAuthMode.textContent = 'Pas encore d\'espace familial ? Créer un compte';
                } else {
                    elements.authSubtitle.textContent = 'Créez votre espace familial';
                    elements.authButtonText.textContent = 'Créer mon espace';
                    elements.nameFields.classList.remove('hidden');
                    elements.switchAuthMode.textContent = 'Déjà un compte ? Se connecter';
                }
            } else {
                elements.authModal.classList.add('hidden');
                elements.app.classList.remove('blur-sm');
            }

            // Show/hide event modal
            if (state.showEventModal) {
                elements.eventModal.classList.remove('hidden');
            } else {
                elements.eventModal.classList.add('hidden');
            }

            // Show/hide task modal
            if (state.showTaskModal) {
                elements.taskModal.classList.remove('hidden');
            } else {
                elements.taskModal.classList.add('hidden');
            }

            // Update navigation
            elements.navBtns.forEach(btn => {
                const view = btn.getAttribute('data-view');
                if (view === state.currentView) {
                    btn.classList.add('bg-gradient-to-r', 'from-gray-100', 'to-gray-50', 'text-gray-700', 'shadow-sm');
                    btn.classList.remove('text-gray-600', 'hover:bg-white/60', 'hover:text-gray-800');
                } else {
                    btn.classList.remove('bg-gradient-to-r', 'from-gray-100', 'to-gray-50', 'text-gray-700', 'shadow-sm');
                    btn.classList.add('text-gray-600', 'hover:bg-white/60', 'hover:text-gray-800');
                }
            });

            // Show current view
            elements.views.forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(`${state.currentView}-view`).classList.remove('hidden');

            // Update meditation UI
            if (state.meditationActive) {
                elements.meditationStatus.textContent = 'Méditation en cours...';
                elements.meditationTimer.textContent = formatTime(state.meditationTimer);
                elements.meditationTimer.classList.remove('hidden');
                elements.meditationToggle.innerHTML = '<i class="fas fa-stop w-4 h-4"></i><span>Arrêter</span>';
                elements.meditationToggle.classList.remove('bg-gradient-to-r', 'from-amber-400', 'to-orange-500');
                elements.meditationToggle.classList.add('bg-gradient-to-r', 'from-red-400', 'to-red-500');
            } else {
                elements.meditationStatus.textContent = 'N\'oubliez pas votre pause méditation';
                elements.meditationTimer.classList.add('hidden');
                elements.meditationToggle.innerHTML = '<i class="fas fa-play w-4 h-4"></i><span>Démarrer</span>';
                elements.meditationToggle.classList.remove('bg-gradient-to-r', 'from-red-400', 'to-red-500');
                elements.meditationToggle.classList.add('bg-gradient-to-r', 'from-amber-400', 'to-orange-500');
            }

            // Render chat messages
            renderChatMessages();

            // Render mini calendar
            renderMiniCalendar();

            // Render today's events
            renderTodaysEvents();

            // Render tasks
            renderTasks();
        }

        // Render chat messages
        function renderChatMessages() {
            elements.chatMessages.innerHTML = '';
            
            state.messages.forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.classList.add('flex', message.type === 'user' ? 'justify-end' : 'justify-start');
                
                if (message.type === 'bot') {
                    messageEl.innerHTML = `
                        <div class="w-10 h-10 nesti-gradient rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 mr-3">
                            <div class="w-6 h-4 bg-white/90 rounded-md flex items-center justify-center">
                                <div class="w-3 h-2 bg-gradient-to-br from-cyan-600 to-teal-600 rounded-sm"></div>
                            </div>
                        </div>
                        <div class="message-bubble bot-message">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-sm font-bold text-gray-700">${message.sender}</span>
                                ${message.type === 'bot' ? `
                                    <div class="typing-dots">
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                    </div>
                                ` : ''}
                            </div>
                            <p class="text-gray-800 text-sm font-medium">${message.content}</p>
                            <p class="text-xs text-gray-500 mt-2">
                                ${message.timestamp.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
                            </p>
                            ${message.suggestions ? `
                                <div class="flex flex-wrap gap-2 mt-3">
                                    ${message.suggestions.map(suggestion => `
                                        <button class="text-xs bg-teal-100 text-teal-700 px-3 py-1 rounded-full hover:bg-teal-200">
                                            ${suggestion}
                                        </button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    messageEl.innerHTML = `
                        <div class="message-bubble user-message">
                            <p class="text-white text-sm font-medium">${message.content}</p>
                            <p class="text-xs text-white/80 mt-2">
                                ${message.timestamp.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
                            </p>
                        </div>
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 ml-3 text-white font-bold text-sm">
                            ${state.user.avatar}
                        </div>
                    `;
                }
                
                elements.chatMessages.appendChild(messageEl);
            });
            
            // Scroll to bottom
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }

        // Render mini calendar
        function renderMiniCalendar() {
            elements.miniCalendar.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 28; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const day = date.getDate();
                const isCurrentMonth = date.getMonth() === currentMonth;
                const isToday = date.toDateString() === today.toDateString();
                const hasEvents = state.events.some(event => 
                    event.date.toDateString() === date.toDateString()
                );
                
                const dayEl = document.createElement('button');
                dayEl.classList.add('calendar-day');
                if (!isCurrentMonth) dayEl.classList.add('text-gray-300');
                if (isToday) dayEl.classList.add('today');
                
                dayEl.innerHTML = `
                    ${day}
                    ${hasEvents ? '<div class="event-indicator"></div>' : ''}
                `;
                
                dayEl.addEventListener('click', () => {
                    state.selectedDate = date;
                    updateUI();
                });
                
                elements.miniCalendar.appendChild(dayEl);
            }
        }

        // Render today's events
        function renderTodaysEvents() {
            elements.todayEvents.innerHTML = '';
            
            const todaysEvents = state.events.filter(event => 
                event.date.toDateString() === state.selectedDate.toDateString()
            );
            
            if (todaysEvents.length === 0) {
                elements.todayEvents.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-calendar w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        <p class="text-sm">Aucun événement prévu</p>
                    </div>
                `;
                return;
            }
            
            todaysEvents.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.classList.add('flex', 'items-center', 'space-x-3', 'p-3', 'rounded-2xl', 'bg-white/40', 'hover:bg-white/60', 'cursor-pointer', 'group');
                
                eventEl.innerHTML = `
                    <div class="w-10 h-10 ${event.color} rounded-xl flex items-center justify-center shadow-sm group-hover:shadow-md">
                        <span class="text-lg">${event.icon}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-600">${event.time}</span>
                            <span class="text-sm font-semibold ${event.textColor}">${event.title}</span>
                        </div>
                        ${event.description ? `
                            <p class="text-xs text-gray-500 mt-1">${event.description}</p>
                        ` : ''}
                    </div>
                `;
                
                elements.todayEvents.appendChild(eventEl);
            });
        }

        // Render tasks
        function renderTasks() {
            elements.tasksList.innerHTML = '';
            
            state.tasks.slice(0, 3).forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.classList.add('flex', 'items-center', 'space-x-3', 'p-3', 'rounded-2xl', 'bg-white/40', 'hover:bg-white/60');
                taskEl.classList.add(`task-priority-${task.priority}`);
                
                taskEl.innerHTML = `
                    <button onclick="toggleTask('${task.id}')" class="w-6 h-6 rounded-lg border-2 flex items-center justify-center ${task.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 hover:border-teal-400'}">
                        ${task.completed ? '<i class="fas fa-check w-4 h-4"></i>' : ''}
                    </button>
                    <div class="flex-1">
                        <p class="font-medium text-sm ${task.completed ? 'line-through text-gray-500' : 'text-gray-700'}">
                            ${task.title}
                        </p>
                        <p class="text-xs text-gray-500">
                            ${task.assignee} • ${task.priority === 'high' ? '🔴' : task.priority === 'medium' ? '🟡' : '🟢'}
                        </p>
                    </div>
                `;
                
                elements.tasksList.appendChild(taskEl);
            });
        }

        // Initialize the application
        init();

        // Expose toggleTask to global scope for HTML onclick
        window.toggleTask = function(taskId) {
            state.tasks = state.tasks.map(task => 
                task.id === taskId ? { ...task, completed: !task.completed } : task
            );
            updateUI();
        };
    </script>
</body>
</html>
