<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nesti - Plateforme Familiale Inclusive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== VARIABLES ET RESET ========== */
        :root {
            --primary: #136bb1;
            --primary-light: #1c9dea;
            --primary-dark: #0a4a7a;
            --accent: #ffd166;
            --accent-dark: #e6b650;
            --success: #29c48a;
            --warning: #ffb347;
            --danger: #ff6b6b;
            --text: #0f172a;
            --text-light: #64748b;
            --bg: #f4fbff;
            --card: #ffffff;
            --card-dark: #f1f5f9;
            --border: #e2e8f0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-lg: 18px;
            --transition: all 0.3s ease;
            --sidebar-width: 280px;
            --header-height: 80px;
        }

        [data-theme="dark"] {
            --primary: #1c9dea;
            --primary-light: #4ab3ff;
            --primary-dark: #136bb1;
            --accent: #ffd166;
            --accent-dark: #e6b650;
            --success: #29c48a;
            --warning: #ffb347;
            --danger: #ff6b6b;
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --bg: #0f172a;
            --card: #1e293b;
            --card-dark: #1a2438;
            --border: #334155;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* ========== LAYOUT PRINCIPAL ========== */
        .app {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--card);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            z-index: 100;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 30px;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
        }

        /* ========== COMPOSANTS ========== */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--card-dark);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-accent {
            background: var(--accent);
            color: var(--text);
        }

        .btn-accent:hover {
            background: var(--accent-dark);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(28, 157, 234, 0.2);
        }

        /* ========== SIDEBAR ========== */
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 32px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius);
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-item:hover {
            background: var(--card-dark);
            color: var(--text);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(28, 157, 234, 0.1), transparent);
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .user-profile {
            margin-top: auto;
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 700;
            font-size: 0.95rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* ========== DASHBOARD ========== */
        .welcome-banner {
            grid-column: span 12;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: var(--radius);
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .welcome-text h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .welcome-text p {
            opacity: 0.9;
        }

        .stats-grid {
            grid-column: span 12;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.events {
            background: rgba(28, 157, 234, 0.1);
            color: var(--primary);
        }

        .stat-icon.tasks {
            background: rgba(255, 209, 102, 0.1);
            color: var(--accent-dark);
        }

        .stat-icon.chat {
            background: rgba(41, 196, 138, 0.1);
            color: var(--success);
        }

        .stat-icon.wellbeing {
            background: rgba(255, 107, 107, 0.1);
            color: var(--danger);
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .calendar-widget {
            grid-column: span 4;
        }

        .chat-widget {
            grid-column: span 5;
        }

        .wellbeing-widget {
            grid-column: span 3;
        }

        /* ========== CALENDRIER ========== */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-weekday {
            text-align: center;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text-light);
            padding: 8px;
        }

        .calendar-day {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .calendar-day:hover {
            background: var(--card-dark);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: 700;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--primary);
        }

        .calendar-day.selected {
            background: var(--primary-light);
            color: white;
        }

        .calendar-day.other-month {
            color: var(--text-light);
            opacity: 0.5;
        }

        .events-list {
            margin-top: 20px;
        }

        .event-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 8px;
            background: var(--card-dark);
            transition: var(--transition);
        }

        .event-item:hover {
            background: var(--border);
        }

        .event-time {
            font-weight: 700;
            color: var(--primary);
            min-width: 60px;
        }

        .event-details {
            flex: 1;
        }

        .event-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .event-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* ========== CHAT ========== */
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot {
            align-self: flex-start;
            background: var(--card-dark);
            color: var(--text);
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .message-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .suggestion {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
        }

        .chat-send {
            width: 50px;
            height: 50px;
            borderRadius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .chat-send:hover {
            background: var(--primary-dark);
        }

        /* ========== BIEN-ÊTRE ========== */
        .wellbeing-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .wellbeing-stat {
            background: var(--card-dark);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .wellbeing-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .wellbeing-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .meditation-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .meditation-timer {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 16px 0;
            color: var(--primary);
        }

        .meditation-button {
            padding: 12px;
            border-radius: var(--radius);
            background: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .meditation-button:hover {
            background: var(--primary-dark);
        }

        .meditation-button.stop {
            background: var(--danger);
        }

        .meditation-button.stop:hover {
            background: #e05555;
        }

        /* ========== TÂCHES ========== */
        .tasks-widget {
            grid-column: span 4;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .task-item:hover {
            background: var(--border);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .task-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .task-priority {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .priority-high {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
        }

        .priority-medium {
            background: rgba(255, 179, 71, 0.2);
            color: var(--warning);
        }

        .priority-low {
            background: rgba(41, 196, 138, 0.2);
            color: var(--success);
        }

        /* ========== ACTIVITÉS ========== */
        .activities-widget {
            grid-column: span 4;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .activity-item {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .activity-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .activity-location {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .activity-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 209, 102, 0.2);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--accent-dark);
        }

        .activity-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }

        .activity-tag {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
            background: rgba(28, 157, 234, 0.1);
            color: var(--primary);
        }

        /* ========== MODALS ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: var(--card);
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 16px;
        }

        /* ========== NOTIFICATIONS ========== */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: var(--radius);
            background: var(--card);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
        }

        .notification.active {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .notification-icon.success {
            background: var(--success);
        }

        .notification-icon.error {
            background: var(--danger);
        }

        .notification-icon.warning {
            background: var(--warning);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .calendar-widget,
            .chat-widget,
            .wellbeing-widget,
            .tasks-widget,
            .activities-widget {
                grid-column: span 6;
            }
        }

        @media (max-width: 900px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 600px) {
            .main-content {
                padding: 16px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-widget,
            .chat-widget,
            .wellbeing-widget,
            .tasks-widget,
            .activities-widget {
                grid-column: span 1;
            }
            
            .welcome-banner {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease;
        }

        .animate-slideIn {
            animation: slideIn 0.5s ease;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        /* ========== ACCESSIBILITY ========== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --text: #000;
                --text-light: #333;
                --bg: #fff;
                --card: #f8f8f8;
                --card-dark: #eee;
                --border: #ccc;
            }
            
            [data-theme="dark"] {
                --text: #fff;
                --text-light: #ccc;
                --bg: #000;
                --card: #111;
                --card-dark: #222;
                --border: #444;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ========== NOUVEAUX STYLES ========== */
        .hidden {
            display: none !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .family-members {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .family-member {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            cursor: pointer;
        }

        .member-name {
            font-size: 0.8rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--card-dark);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .filter-btn {
            padding: 6px 12px;
            border-radius: 20px;
            background: var(--card-dark);
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .context-menu {
            position: absolute;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            overflow: hidden;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .context-menu-item:hover {
            background: var(--card-dark);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .badge-primary {
            background: rgba(28, 157, 234, 0.1);
            color: var(--primary);
        }

        .badge-success {
            background: rgba(41, 196, 138, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 179, 71, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(255, 107, 107, 0.1);
            color: var(--danger);
        }

        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            min-width: 150px;
            overflow: hidden;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background: var(--card-dark);
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            padding: 16px 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: var(--text);
            color: var(--bg);
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
        }

        .carousel {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius);
        }

        .carousel-inner {
            display: flex;
            transition: transform 0.3s ease;
        }

        .carousel-item {
            min-width: 100%;
        }

        .carousel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
        }

        .carousel-control.prev {
            left: 10px;
        }

        .carousel-control.next {
            right: 10px;
        }

        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
        }

        .page-item {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            cursor: pointer;
        }

        .page-item.active {
            background: var(--primary);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            padding-left: 40px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .sortable-ghost {
            opacity: 0.5;
        }

        .sortable-chosen {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .drag-handle {
            cursor: move;
            color: var(--text-light);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.selected {
            border-color: var(--text);
        }

        .audio-player {
            width: 100%;
            margin-top: 16px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .audio-progress {
            flex: 1;
            height: 4px;
            background: var(--card-dark);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .audio-progress-filled {
            height: 100%;
            background: var(--primary);
        }

        .audio-time {
            font-size: 0.8rem;
            color: var(--text-light);
            min-width: 80px;
            text-align: right;
        }

        .voice-recorder {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .record-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
        }

        .record-btn.recording {
            animation: pulse 1s infinite;
        }

        .waveform {
            flex: 1;
            height: 40px;
            background: var(--card-dark);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to top, var(--primary), transparent);
            opacity: 0.5;
            transform-origin: bottom;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--primary);
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
        }

        .achievement-badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin: 0 auto 16px;
            box-shadow: var(--shadow-lg);
        }

        .streak-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card-dark);
            padding: 8px 12px;
            border-radius: 20px;
        }

        .streak-number {
            font-weight: 700;
            color: var(--accent-dark);
        }

        .habit-tracker {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 16px;
        }

        .habit-day {
            aspect-ratio: 1;
            border-radius: 6px;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .habit-day.completed {
            background: var(--success);
            color: white;
        }

        .habit-day.partial {
            background: linear-gradient(135deg, var(--success) 50%, var(--card-dark) 50%);
        }

        .habit-day.missed {
            background: var(--danger);
            color: white;
        }

        .mood-picker {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            opacity: 0.6;
            transition: var(--transition);
        }

        .mood-option:hover,
        .mood-option.selected {
            opacity: 1;
            transform: scale(1.1);
        }

        .mood-emoji {
            font-size: 1.5rem;
        }

        .mood-label {
            font-size: 0.8rem;
        }

        .timeline {
            position: relative;
            padding-left: 20px;
            margin-left: 10px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .timeline-content {
            background: var(--card-dark);
            padding: 12px;
            border-radius: var(--radius);
        }

        .interactive-tutorial {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .interactive-tutorial.active {
            opacity: 1;
            pointer-events: all;
        }

        .tutorial-content {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 400px;
            position: relative;
        }

        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .tutorial-indicators {
            display: flex;
            gap: 6px;
            justify-content: center;
            margin-top: 16px;
        }

        .tutorial-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }

        .tutorial-indicator.active {
            background: var(--primary);
        }

        .hotkey-hint {
            display: inline-block;
            padding: 2px 6px;
            background: var(--card-dark);
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
            border: 1px solid var(--border);
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--card-dark);
        }

        .status-online {
            color: var(--success);
        }

        .status-offline {
            color: var(--danger);
        }

        .status-syncing {
            color: var(--warning);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-online .status-dot {
            background: var(--success);
        }

        .status-offline .status-dot {
            background: var(--danger);
        }

        .status-syncing .status-dot {
            background: var(--warning);
            animation: pulse 2s infinite;
        }

        .sync-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .data-sync-info {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .privacy-shield {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: rgba(41, 196, 138, 0.1);
            color: var(--success);
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .encryption-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .data-usage-bar {
            height: 6px;
            background: var(--card-dark);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .data-usage-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-top: 12px;
        }

        .backup-status.success {
            border-left: 3px solid var(--success);
        }

        .backup-status.warning {
            border-left: 3px solid var(--warning);
        }

        .backup-status.error {
            border-left: 3px solid var(--danger);
        }

        .backup-icon {
            font-size: 1.2rem;
        }

        .backup-info {
            flex: 1;
        }

        .backup-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .backup-details {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .backup-action {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .family-code {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-dark);
            padding: 12px;
            border-radius: var(--radius);
            margin-top: 16px;
        }

        .code-value {
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            flex: 1;
            text-align: center;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .members-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
        }

        .member-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .member-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .invite-section {
            margin-top: 24px;
        }

        .invite-input-group {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .invite-input {
            flex: 1;
        }

        .role-select {
            min-width: 120px;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .permission-checkbox {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .permission-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .permission-label {
            font-size: 0.9rem;
        }

        .security-log {
            margin-top: 24px;
        }

        .log-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .log-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .log-details {
            flex: 1;
        }

        .log-action {
            font-weight: 600;
        }

        .log-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .log-date {
            flex: 1;
        }

        .log-ip {
            font-family: monospace;
        }

        .two-factor-setup {
            margin-top: 24px;
        }

        .qrcode-container {
            text-align: center;
            margin: 16px 0;
            padding: 16px;
            background: white;
            border-radius: var(--radius);
            display: inline-block;
        }

        .backup-codes {
            margin-top: 16px;
            background: var(--card-dark);
            padding: 16px;
            border-radius: var(--radius);
        }

        .backup-codes-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
            font-family: monospace;
        }

        .data-export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .export-option {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .export-option:hover {
            background: var(--primary);
            color: white;
        }

        .export-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .export-format {
            font-weight: 600;
        }

        .export-info {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .storage-usage {
            margin-top: 24px;
        }

        .usage-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .usage-category {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .usage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .usage-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .usage-size {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .usage-bar {
            height: 6px;
            background: var(--card);
            border-radius: 3px;
            overflow: hidden;
        }

        .usage-fill {
            height: 100%;
            border-radius: 3px;
        }

        .usage-events .usage-fill {
            background: var(--primary);
        }

        .usage-media .usage-fill {
            background: var(--success);
        }

        .usage-documents .usage-fill {
            background: var(--warning);
        }

        .usage-other .usage-fill {
            background: var(--danger);
        }

        .auto-delete-options {
            margin-top: 16px;
        }

        .auto-delete-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .auto-delete-label {
            flex: 1;
        }

        .auto-delete-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .auto-delete-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .auto-delete-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .auto-delete-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .auto-delete-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .auto-delete-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .auto-delete-checkbox:checked + .auto-delete-slider {
            background: var(--primary);
        }

        .auto-delete-checkbox:checked + .auto-delete-slider::before {
            transform: translateX(20px);
        }

        .privacy-settings {
            margin-top: 24px;
        }

        .privacy-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .privacy-label {
            flex: 1;
        }

        .privacy-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .privacy-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .privacy-select {
            min-width: 120px;
        }

        .data-sources {
            margin-top: 24px;
        }

        .data-source {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .source-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .source-info {
            flex: 1;
        }

        .source-name {
            font-weight: 600;
        }

        .source-status {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .source-action {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
        }

        .advanced-settings {
            margin-top: 24px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .setting-label {
            flex: 1;
        }

        .setting-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .setting-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .reset-btn {
            padding: 6px 12px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .danger-zone {
            margin-top: 32px;
            padding: 24px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: var(--radius);
            border: 1px solid var(--danger);
        }

        .danger-title {
            color: var(--danger);
            font-weight: 700;
            margin-bottom: 16px;
        }

        .danger-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .danger-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: white;
            border: 1px solid var(--danger);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .danger-btn:hover {
            background: var(--danger);
            color: white;
        }

        .danger-btn-content {
            flex: 1;
        }

        .danger-btn-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .danger-btn-desc {
            font-size: 0.8rem;
        }

        .danger-btn-icon {
            color: var(--danger);
        }

        .danger-btn:hover .danger-btn-icon {
            color: white;
        }

        .help-section {
            margin-top: 32px;
        }

        .help-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .help-category {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .help-category:hover {
            background: var(--primary);
            color: white;
        }

        .help-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .help-name {
            font-weight: 600;
        }

        .faq-list {
            margin-top: 24px;
        }

        .faq-item {
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            cursor: pointer;
            font-weight: 600;
        }

        .faq-answer {
            padding: 0 16px 16px;
            color: var(--text-light);
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .contact-support {
            margin-top: 32px;
            text-align: center;
        }

        .support-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .support-option {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .support-option:hover {
            background: var(--primary);
            color: white;
        }

        .support-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .support-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .support-desc {
            font-size: 0.9rem;
        }

        .feedback-form {
            margin-top: 32px;
        }

        .feedback-rating {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 16px 0;
        }

        .rating-star {
            font-size: 2rem;
            color: var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-star:hover,
        .rating-star.active {
            color: var(--accent);
        }

        .feedback-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .feedback-type {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .feedback-type:hover,
        .feedback-type.active {
            background: var(--primary);
            color: white;
        }

        .community-forum {
            margin-top: 32px;
        }

        .forum-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .forum-stat {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .forum-posts {
            margin-top: 24px;
        }

        .forum-post {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .post-author {
            font-weight: 600;
        }

        .post-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .post-title {
            font-weight: 700;
            margin-bottom: 8px;
        }

        .post-content {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .post-footer {
            display: flex;
            gap: 16px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
        }

        .post-action:hover {
            color: var(--primary);
        }

        .whats-new {
            margin-top: 32px;
        }

        .changelog {
            margin-top: 16px;
        }

        .changelog-version {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .version-number {
            font-weight: 700;
        }

        .version-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .version-changes {
            list-style-type: disc;
            padding-left: 20px;
            color: var(--text-light);
        }

        .version-change {
            margin-bottom: 6px;
        }

        .keyboard-shortcuts {
            margin-top: 32px;
        }

        .shortcuts-list {
            margin-top: 16px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .shortcut-action {
            font-weight: 600;
        }

        .shortcut-keys {
            display: flex;
            gap: 4px;
        }

        .shortcut-key {
            padding: 4px 8px;
            background: var(--card-dark);
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: monospace;
        }

        .accessibility-options {
            margin-top: 32px;
        }

        .accessibility-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .accessibility-label {
            flex: 1;
        }

        .accessibility-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .accessibility-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .accessibility-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .accessibility-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .accessibility-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .accessibility-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .accessibility-checkbox:checked + .accessibility-slider {
            background: var(--primary);
        }

        .accessibility-checkbox:checked + .accessibility-slider::before {
            transform: translateX(20px);
        }

        .text-size-preview {
            margin-top: 16px;
            padding: 16px;
            background: var(--card);
            border-radius: var(--radius);
            text-align: center;
        }

        .preview-text {
            margin: 0;
            transition: font-size 0.3s ease;
        }

        .color-contrast-demo {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .contrast-example {
            padding: 16px;
            border-radius: var(--radius);
            text-align: center;
        }

        .contrast-good {
            background: var(--text);
            color: var(--bg);
        }

        .contrast-bad {
            background: #999;
            color: #eee;
        }

        .contrast-label {
            font-size: 0.8rem;
            margin-top: 8px;
        }

        .voice-control-demo {
            text-align: center;
            margin-top: 24px;
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .voice-status {
            font-size: 0.9rem;
            margin: 16px 0;
            min-height: 20px;
        }

        .voice-command {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .legal-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .legal-link {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .legal-link:hover {
            background: var(--primary);
            color: white;
        }

        .about-app {
            margin-top: 32px;
            text-align: center;
        }

        .app-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .info-item {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .info-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .info-value {
            font-weight: 600;
        }

        .contributors {
            margin-top: 32px;
        }

        .contributors-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .contributor {
            text-align: center;
        }

        .contributor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto 8px;
        }

        .contributor-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .contributor-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            transition: var(--transition);
        }

        .social-link:hover {
            background: var(--primary);
            color: white;
        }

        .app-credits {
            margin-top: 32px;
            text-align: center;
            color: var(--text-light);
        }

        .third-party-licenses {
            margin-top: 24px;
        }

        .license-item {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .license-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .license-details {
            font-size: 0.8rem;
        }

        .license-link {
            color: var(--primary);
            text-decoration: none;
        }

        .donate-section {
            margin-top: 32px;
            text-align: center;
        }

        .donate-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .donate-option {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .donate-option:hover {
            background: var(--primary);
            color: white;
        }

        .donate-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .donate-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .donate-desc {
            font-size: 0.9rem;
        }

        .subscription-info {
            margin-top: 24px;
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .subscription-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: var(--success);
            color: white;
        }

        .status-inactive {
            background: var(--danger);
            color: white;
        }

        .subscription-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .subscription-feature {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-check {
            color: var(--success);
        }

        .feature-unavailable {
            color: var(--text-light);
        }

        .upgrade-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            text-align: center;
        }

        .beta-features {
            margin-top: 32px;
        }

        .beta-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .beta-badge {
            padding: 2px 6px;
            background: var(--accent);
            color: var(--text);
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .feature-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .feature-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .feature-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .feature-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .feature-checkbox:checked + .feature-slider {
            background: var(--primary);
        }

        .feature-checkbox:checked + .feature-slider::before {
            transform: translateX(20px);
        }

        .experimental-warning {
            padding: 16px;
            background: rgba(255, 179, 71, 0.1);
            border-radius: var(--radius);
            border-left: 3px solid var(--warning);
            margin-top: 16px;
        }

        .warning-icon {
            color: var(--warning);
            margin-right: 8px;
        }

        .language-selector {
            margin-top: 24px;
        }

        .language-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .language-option {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .language-option:hover,
        .language-option.active {
            background: var(--primary);
            color: white;
        }

        .language-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .language-native {
            font-size: 0.8rem;
        }

        .region-settings {
            margin-top: 24px;
        }

        .region-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .region-option {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .region-option:hover,
        .region-option.active {
            background: var(--primary);
            color: white;
        }

        .region-flag {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .region-name {
            font-weight: 600;
        }

        .export-language {
            margin-top: 16px;
            text-align: center;
        }

        .export-button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .import-language {
            margin-top: 16px;
            text-align: center;
        }

        .import-button {
            display: inline-block;
            padding: 8px 16px;
            background: var(--card-dark);
            color: var(--text);
            border-radius: var(--radius);
            cursor: pointer;
        }

        .import-file {
            display: none;
        }

        .translation-progress {
            margin-top: 24px;
        }

        .progress-bar {
            height: 8px;
            background: var(--card);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--text-light);
            text-align: center;
        }

        .contribute-translation {
            margin-top: 16px;
            text-align: center;
        }

        .contribute-button {
            padding: 8px 16px;
            background: var(--accent);
            color: var(--text);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .help-translate {
            margin-top: 32px;
            text-align: center;
        }

        .translation-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .translation-stat {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .translation-leaders {
            margin-top: 24px;
        }

        .leaders-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .leader {
            text-align: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .leader-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto 8px;
        }

        .leader-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .leader-contributions {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .join-translation {
            margin-top: 24px;
            text-align: center;
        }

        .join-button {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .translation-resources {
            margin-top: 32px;
        }

        .resources-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .resource {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .resource:hover {
            background: var(--primary);
            color: white;
        }

        .resource-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .resource-name {
            font-weight: 600;
        }

        .translation-guidelines {
            margin-top: 32px;
        }

        .guidelines-list {
            margin-top: 16px;
        }

        .guideline {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .guideline-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .guideline-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .translation-faq {
            margin-top: 32px;
        }

        .translation-community {
            margin-top: 32px;
            text-align: center;
        }

        .community-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .community-stat {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .community-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .community-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .community-links {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
        }

        .community-link {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
        }

        .community-chat {
            margin-top: 32px;
            text-align: center;
        }

        .chat-embed {
            margin-top: 16px;
            height: 400px;
            background: var(--card-dark);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .chat-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-light);
        }

        .community-events {
            margin-top: 32px;
        }

        .events-list {
            margin-top: 16px;
        }

        .community-event {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .event-title {
            font-weight: 700;
        }

        .event-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .event-description {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .event-actions {
            display: flex;
            gap: 12px;
        }

        .event-action {
            padding: 6px 12px;
            background: var(--primary);
            color: white;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .community-forum-link {
            margin-top: 24px;
            text-align: center;
        }

        .forum-link {
            padding: 12px 24px;
            background: var(--accent);
            color: var(--text);
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
        }

        /* Additional styles for new components */
        .context-menu {
            position: absolute;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            overflow: hidden;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .context-menu-item:hover {
            background: var(--card-dark);
        }

        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            min-width: 150px;
            overflow: hidden;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background: var(--card-dark);
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            padding: 16px 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .tooltip {
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 12px;
            background: var(--text);
            color: var(--bg);
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
        }

        .carousel {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius);
        }

        .carousel-inner {
            display: flex;
            transition: transform 0.3s ease;
        }

        .carousel-item {
            min-width: 100%;
        }

        .carousel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
        }

        .carousel-control.prev {
            left: 10px;
        }

        .carousel-control.next {
            right: 10px;
        }

        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
        }

        .page-item {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            cursor: pointer;
        }

        .page-item.active {
            background: var(--primary);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            padding-left: 40px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .sortable-ghost {
            opacity: 0.5;
        }

        .sortable-chosen {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .drag-handle {
            cursor: move;
            color: var(--text-light);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.selected {
            border-color: var(--text);
        }

        .audio-player {
            width: 100%;
            margin-top: 16px;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .audio-progress {
            flex: 1;
            height: 4px;
            background: var(--card-dark);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .audio-progress-filled {
            height: 100%;
            background: var(--primary);
        }

        .audio-time {
            font-size: 0.8rem;
            color: var(--text-light);
            min-width: 80px;
            text-align: right;
        }

        .voice-recorder {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .record-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
        }

        .record-btn.recording {
            animation: pulse 1s infinite;
        }

        .waveform {
            flex: 1;
            height: 40px;
            background: var(--card-dark);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to top, var(--primary), transparent);
            opacity: 0.5;
            transform-origin: bottom;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--primary);
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
        }

        .achievement-badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin: 0 auto 16px;
            box-shadow: var(--shadow-lg);
        }

        .streak-counter {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card-dark);
            padding: 8px 12px;
            border-radius: 20px;
        }

        .streak-number {
            font-weight: 700;
            color: var(--accent-dark);
        }

        .habit-tracker {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 16px;
        }

        .habit-day {
            aspect-ratio: 1;
            border-radius: 6px;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .habit-day.completed {
            background: var(--success);
            color: white;
        }

        .habit-day.partial {
            background: linear-gradient(135deg, var(--success) 50%, var(--card-dark) 50%);
        }

        .habit-day.missed {
            background: var(--danger);
            color: white;
        }

        .mood-picker {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            opacity: 0.6;
            transition: var(--transition);
        }

        .mood-option:hover,
        .mood-option.selected {
            opacity: 1;
            transform: scale(1.1);
        }

        .mood-emoji {
            font-size: 1.5rem;
        }

        .mood-label {
            font-size: 0.8rem;
        }

        .timeline {
            position: relative;
            padding-left: 20px;
            margin-left: 10px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 6px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .timeline-content {
            background: var(--card-dark);
            padding: 12px;
            border-radius: var(--radius);
        }

        .interactive-tutorial {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .interactive-tutorial.active {
            opacity: 1;
            pointer-events: all;
        }

        .tutorial-content {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 400px;
            position: relative;
        }

        .tutorial-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .tutorial-indicators {
            display: flex;
            gap: 6px;
            justify-content: center;
            margin-top: 16px;
        }

        .tutorial-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
        }

        .tutorial-indicator.active {
            background: var(--primary);
        }

        .hotkey-hint {
            display: inline-block;
            padding: 2px 6px;
            background: var(--card-dark);
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
            border: 1px solid var(--border);
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--card-dark);
        }

        .status-online {
            color: var(--success);
        }

        .status-offline {
            color: var(--danger);
        }

        .status-syncing {
            color: var(--warning);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-online .status-dot {
            background: var(--success);
        }

        .status-offline .status-dot {
            background: var(--danger);
        }

        .status-syncing .status-dot {
            background: var(--warning);
            animation: pulse 2s infinite;
        }

        .sync-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .data-sync-info {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .privacy-shield {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: rgba(41, 196, 138, 0.1);
            color: var(--success);
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .encryption-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .data-usage-bar {
            height: 6px;
            background: var(--card-dark);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .data-usage-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-top: 12px;
        }

        .backup-status.success {
            border-left: 3px solid var(--success);
        }

        .backup-status.warning {
            border-left: 3px solid var(--warning);
        }

        .backup-status.error {
            border-left: 3px solid var(--danger);
        }

        .backup-icon {
            font-size: 1.2rem;
        }

        .backup-info {
            flex: 1;
        }

        .backup-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .backup-details {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .backup-action {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .family-code {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--card-dark);
            padding: 12px;
            border-radius: var(--radius);
            margin-top: 16px;
        }

        .code-value {
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            flex: 1;
            text-align: center;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .members-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 600;
        }

        .member-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .member-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .invite-section {
            margin-top: 24px;
        }

        .invite-input-group {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .invite-input {
            flex: 1;
        }

        .role-select {
            min-width: 120px;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .permission-checkbox {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .permission-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .permission-label {
            font-size: 0.9rem;
        }

        .security-log {
            margin-top: 24px;
        }

        .log-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .log-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .log-details {
            flex: 1;
        }

        .log-action {
            font-weight: 600;
        }

        .log-meta {
            display: flex;
            gap: 12px;
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .log-date {
            flex: 1;
        }

        .log-ip {
            font-family: monospace;
        }

        .two-factor-setup {
            margin-top: 24px;
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .qrcode-container {
            text-align: center;
            margin: 16px 0;
            padding: 16px;
            background: white;
            border-radius: var(--radius);
            display: inline-block;
        }

        .backup-codes {
            margin-top: 16px;
            background: var(--card);
            padding: 16px;
            border-radius: var(--radius);
        }

        .backup-codes-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
            font-family: monospace;
        }

        .data-export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .export-option {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .export-option:hover {
            background: var(--primary);
            color: white;
        }

        .export-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .export-format {
            font-weight: 600;
        }

        .export-info {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .storage-usage {
            margin-top: 24px;
        }

        .usage-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .usage-category {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .usage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .usage-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .usage-size {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .usage-bar {
            height: 6px;
            background: var(--card);
            border-radius: 3px;
            overflow: hidden;
        }

        .usage-fill {
            height: 100%;
            border-radius: 3px;
        }

        .usage-events .usage-fill {
            background: var(--primary);
        }

        .usage-media .usage-fill {
            background: var(--success);
        }

        .usage-documents .usage-fill {
            background: var(--warning);
        }

        .usage-other .usage-fill {
            background: var(--danger);
        }

        .auto-delete-options {
            margin-top: 16px;
        }

        .auto-delete-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .auto-delete-label {
            flex: 1;
        }

        .auto-delete-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .auto-delete-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .auto-delete-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .auto-delete-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .auto-delete-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .auto-delete-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .auto-delete-checkbox:checked + .auto-delete-slider {
            background: var(--primary);
        }

        .auto-delete-checkbox:checked + .auto-delete-slider::before {
            transform: translateX(20px);
        }

        .privacy-settings {
            margin-top: 24px;
        }

        .privacy-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .privacy-label {
            flex: 1;
        }

        .privacy-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .privacy-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .privacy-select {
            min-width: 120px;
        }

        .data-sources {
            margin-top: 24px;
        }

        .data-source {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .source-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .source-info {
            flex: 1;
        }

        .source-name {
            font-weight: 600;
        }

        .source-status {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .source-action {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
        }

        .advanced-settings {
            margin-top: 24px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .setting-label {
            flex: 1;
        }

        .setting-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .setting-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .reset-btn {
            padding: 6px 12px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .danger-zone {
            margin-top: 32px;
            padding: 24px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: var(--radius);
            border: 1px solid var(--danger);
        }

        .danger-title {
            color: var(--danger);
            font-weight: 700;
            margin-bottom: 16px;
        }

        .danger-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .danger-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: white;
            border: 1px solid var(--danger);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .danger-btn:hover {
            background: var(--danger);
            color: white;
        }

        .danger-btn-content {
            flex: 1;
            text-align: left;
        }

        .danger-btn-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .danger-btn-desc {
            font-size: 0.8rem;
        }

        .danger-btn-icon {
            color: var(--danger);
        }

        .danger-btn:hover .danger-btn-icon {
            color: white;
        }

        .help-section {
            margin-top: 32px;
        }

        .help-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .help-category {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .help-category:hover {
            background: var(--primary);
            color: white;
        }

        .help-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .help-name {
            font-weight: 600;
        }

        .faq-list {
            margin-top: 24px;
        }

        .faq-item {
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            cursor: pointer;
            font-weight: 600;
        }

        .faq-answer {
            padding: 0 16px 16px;
            color: var(--text-light);
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .contact-support {
            margin-top: 32px;
            text-align: center;
        }

        .support-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .support-option {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .support-option:hover {
            background: var(--primary);
            color: white;
        }

        .support-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .support-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .support-desc {
            font-size: 0.9rem;
        }

        .feedback-form {
            margin-top: 32px;
        }

        .feedback-rating {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 16px 0;
        }

        .rating-star {
            font-size: 2rem;
            color: var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-star:hover,
        .rating-star.active {
            color: var(--accent);
        }

        .feedback-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .feedback-type {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .feedback-type:hover,
        .feedback-type.active {
            background: var(--primary);
            color: white;
        }

        .community-forum {
            margin-top: 32px;
        }

        .forum-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .forum-stat {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .forum-posts {
            margin-top: 24px;
        }

        .forum-post {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .post-author {
            font-weight: 600;
        }

        .post-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .post-title {
            font-weight: 700;
            margin-bottom: 8px;
        }

        .post-content {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .post-footer {
            display: flex;
            gap: 16px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
        }

        .post-action:hover {
            color: var(--primary);
        }

        .whats-new {
            margin-top: 32px;
        }

        .changelog {
            margin-top: 16px;
        }

        .changelog-version {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .version-number {
            font-weight: 700;
        }

        .version-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .version-changes {
            list-style-type: disc;
            padding-left: 20px;
            color: var(--text-light);
        }

        .version-change {
            margin-bottom: 6px;
        }

        .keyboard-shortcuts {
            margin-top: 32px;
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .shortcuts-list {
            margin-top: 16px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        .shortcut-action {
            font-weight: 600;
        }

        .shortcut-keys {
            display: flex;
            gap: 4px;
        }

        .shortcut-key {
            padding: 4px 8px;
            background: var(--card);
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: monospace;
        }

        .accessibility-options {
            margin-top: 32px;
        }

        .accessibility-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .accessibility-label {
            flex: 1;
        }

        .accessibility-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .accessibility-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .accessibility-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .accessibility-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .accessibility-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .accessibility-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .accessibility-checkbox:checked + .accessibility-slider {
            background: var(--primary);
        }

        .accessibility-checkbox:checked + .accessibility-slider::before {
            transform: translateX(20px);
        }

        .text-size-preview {
            margin-top: 16px;
            padding: 16px;
            background: var(--card);
            border-radius: var(--radius);
            text-align: center;
        }

        .preview-text {
            margin: 0;
            transition: font-size 0.3s ease;
        }

        .color-contrast-demo {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .contrast-example {
            padding: 16px;
            border-radius: var(--radius);
            text-align: center;
        }

        .contrast-good {
            background: var(--text);
            color: var(--bg);
        }

        .contrast-bad {
            background: #999;
            color: #eee;
        }

        .contrast-label {
            font-size: 0.8rem;
            margin-top: 8px;
        }

        .voice-control-demo {
            text-align: center;
            margin-top: 24px;
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .voice-status {
            font-size: 0.9rem;
            margin: 16px 0;
            min-height: 20px;
            color: var(--text-light);
        }

        .voice-command {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .legal-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .legal-link {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .legal-link:hover {
            background: var(--primary);
            color: white;
        }

        .about-app {
            margin-top: 32px;
            text-align: center;
        }

        .app-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 24px 0;
        }

        .info-item {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .info-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .info-value {
            font-weight: 600;
        }

        .contributors {
            margin-top: 32px;
        }

        .contributors-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .contributor {
            text-align: center;
        }

        .contributor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto 8px;
            font-size: 1.2rem;
        }

        .contributor-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .contributor-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
        }

        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            transition: var(--transition);
        }

        .social-link:hover {
            background: var(--primary);
            color: white;
        }

        .app-credits {
            margin-top: 32px;
            text-align: center;
            color: var(--text-light);
        }

        .third-party-licenses {
            margin-top: 24px;
        }

        .license-item {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .license-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .license-details {
            font-size: 0.8rem;
        }

        .license-link {
            color: var(--primary);
            text-decoration: none;
        }

        .donate-section {
            margin-top: 32px;
            text-align: center;
        }

        .donate-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .donate-option {
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .donate-option:hover {
            background: var(--primary);
            color: white;
        }

        .donate-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .donate-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .donate-desc {
            font-size: 0.9rem;
        }

        .subscription-info {
            margin-top: 24px;
            padding: 24px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .subscription-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: var(--success);
            color: white;
        }

        .status-inactive {
            background: var(--danger);
            color: white;
        }

        .subscription-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .subscription-feature {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-check {
            color: var(--success);
        }

        .feature-unavailable {
            color: var(--text-light);
        }

        .upgrade-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            text-align: center;
        }

        .beta-features {
            margin-top: 32px;
        }

        .beta-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .beta-badge {
            padding: 2px 6px;
            background: var(--accent);
            color: var(--text);
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .feature-toggle {
            position: relative;
            width: 40px;
            height: 20px;
        }

        .feature-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .feature-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 20px;
        }

        .feature-slider::before {
            content: '';
            position: absolute;
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .feature-checkbox:checked + .feature-slider {
            background: var(--primary);
        }

        .feature-checkbox:checked + .feature-slider::before {
            transform: translateX(20px);
        }

        .experimental-warning {
            padding: 16px;
            background: rgba(255, 179, 71, 0.1);
            border-radius: var(--radius);
            border-left: 3px solid var(--warning);
            margin-top: 16px;
        }

        .warning-icon {
            color: var(--warning);
            margin-right: 8px;
        }

        .language-selector {
            margin-top: 24px;
        }

        .language-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .language-option {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .language-option:hover,
        .language-option.active {
            background: var(--primary);
            color: white;
        }

        .language-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .language-native {
            font-size: 0.8rem;
        }

        .region-settings {
            margin-top: 24px;
        }

        .region-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .region-option {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .region-option:hover,
        .region-option.active {
            background: var(--primary);
            color: white;
        }

        .region-flag {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .region-name {
            font-weight: 600;
        }

        .export-language {
            margin-top: 16px;
            text-align: center;
        }

        .export-button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
        }

        .import-language {
            margin-top: 16px;
            text-align: center;
        }

        .import-button {
            display: inline-block;
            padding: 8px 16px;
            background: var(--card-dark);
            color: var(--text);
            border-radius: var(--radius);
            cursor: pointer;
        }

        .import-file {
            display: none;
        }

        .translation-progress {
            margin-top: 24px;
        }

        .progress-bar {
            height: 8px;
            background: var(--card);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
        }

        .progress-text {
            font-size: 0.8rem;
            color: var(--text-light);
            text-align: center;
        }

        .contribute-translation {
            margin-top: 16px;
            text-align: center;
        }

        .contribute-button {
            padding: 8px 16px;
            background: var(--accent);
            color: var(--text);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .help-translate {
            margin-top: 32px;
            text-align: center;
        }

        .translation-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .translation-stat {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .translation-leaders {
            margin-top: 24px;
        }

        .leaders-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .leader {
            text-align: center;
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
        }

        .leader-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto 8px;
        }

        .leader-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .leader-contributions {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .join-translation {
            margin-top: 24px;
            text-align: center;
        }

        .join-button {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .translation-resources {
            margin-top: 32px;
        }

        .resources-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        .resource {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .resource:hover {
            background: var(--primary);
            color: white;
        }

        .resource-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .resource-name {
            font-weight: 600;
        }

        .translation-guidelines {
            margin-top: 32px;
        }

        .guidelines-list {
            margin-top: 16px;
        }

        .guideline {
            padding: 12px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }

        .guideline-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .guideline-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .translation-faq {
            margin-top: 32px;
        }

        .translation-community {
            margin-top: 32px;
            text-align: center;
        }

        .community-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 16px 0;
        }

        .community-stat {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            text-align: center;
        }

        .community-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .community-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .community-links {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
        }

        .community-link {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
        }

        .community-chat {
            margin-top: 32px;
            text-align: center;
        }

        .chat-embed {
            margin-top: 16px;
            height: 400px;
            background: var(--card-dark);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .chat-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-light);
        }

        .community-events {
            margin-top: 32px;
        }

        .events-list {
            margin-top: 16px;
        }

        .community-event {
            padding: 16px;
            background: var(--card-dark);
            border-radius: var(--radius);
            margin-bottom: 16px;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .event-title {
            font-weight: 700;
        }

        .event-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .event-description {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .event-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .event-action {
            padding: 6px 12px;
            background: var(--primary);
            color: white;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .community-forum-link {
            margin-top: 24px;
            text-align: center;
        }

        .forum-link {
            padding: 12px 24px;
            background: var(--accent);
            color: var(--text);
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
        }

        /* Responsive adjustments for new components */
        @media (max-width: 768px) {
            .permissions-grid {
                grid-template-columns: 1fr;
            }
            
            .data-export-options {
                grid-template-columns: 1fr;
            }
            
            .usage-breakdown {
                grid-template-columns: 1fr;
            }
            
            .support-options {
                grid-template-columns: 1fr;
            }
            
            .forum-stats {
                grid-template-columns: 1fr;
            }
            
            .app-info {
                grid-template-columns: 1fr;
            }
            
            .contributors-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .donate-options {
                grid-template-columns: 1fr;
            }
            
            .subscription-details {
                grid-template-columns: 1fr;
            }
            
            .language-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .region-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .translation-stats {
                grid-template-columns: 1fr;
            }
            
            .leaders-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .resources-list {
                grid-template-columns: 1fr;
            }
            
            .community-stats {
                grid-template-columns: 1fr;
            }
            
            .community-links {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .contributors-list {
                grid-template-columns: 1fr;
            }
            
            .language-options {
                grid-template-columns: 1fr;
            }
            
            .region-options {
                grid-template-columns: 1fr;
            }
            
            .leaders-list {
                grid-template-columns: 1fr;
            }
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
        }
        
        main {
            flex: 1;
            padding: 2rem 0;
        }
        
        .content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        /* Styles pour le footer */
        footer {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 60px 0 20px;
            margin-top: auto;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
        }
        
        .footer-section h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background-color: #3498db;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: #bdc3c7;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: #3498db;
            padding-left: 5px;
        }
        
        .contact-info {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .contact-info i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-icons a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #34495e;
            color: white;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .social-icons a:hover {
            background-color: #3498db;
            transform: translateY(-3px);
        }
        
        .newsletter form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .newsletter input {
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            background-color: #34495e;
            color: white;
        }
        
        .newsletter input::placeholder {
            color: #bdc3c7;
        }
        
        .newsletter button {
            padding: 12px 15px;
            border: none;
            border-radius: 4px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .newsletter button:hover {
            background-color: #2980b9;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #34495e;
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                gap: 30px;
            }
            
            .footer-section {
                width: 100%;
            }
        }
    </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Nesti — Prototype</h1>
        <div class="muted">Gestion familiale — Demo local</div>
      </div>

      <div id="user-area" class="small right">
        <div id="not-logged">
          <button id="btn-show-auth" class="ghost" aria-expanded="false">Se connecter / S'inscrire</button>
        </div>

        <div id="logged" class="hidden" aria-hidden="true">
          <span id="user-name" class="pill" title="Utilisateur connecté"></span>
          <div class="controls" style="display:inline-flex;">
            <button id="btn-account" class="ghost" title="Mon compte">Compte</button>
            <button id="btn-logout" class="ghost" title="Se déconnecter">Se déconnecter</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Auth / Register & Login -->
    <div id="auth-card" class="card hidden" aria-hidden="true">
      <h3>Connexion / Inscription</h3>
      <div class="cols">
        <div>
          <form id="form-register" autocomplete="on" novalidate>
            <h4>Créer un compte</h4>
            <input name="name" placeholder="Nom (optionnel)" />
            <input name="email" type="email" placeholder="Email" required />
            <div style="display:flex; gap:8px; align-items:center;">
              <input name="password" id="reg-password" type="password" placeholder="Mot de passe (min 8 caractères)" required minlength="8" />
              <button type="button" class="toggle-pass ghost" data-target="#reg-password" aria-pressed="false">Afficher</button>
            </div>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button type="submit">S'inscrire</button>
              <button type="button" id="btn-fill-demo" class="ghost">Remplir (demo)</button>
            </div>
            <div id="reg-msg" class="muted small" role="status" aria-live="polite"></div>
          </form>
        </div>

        <div>
          <form id="form-login" autocomplete="on" novalidate>
            <h4>Se connecter</h4>
            <input name="email" type="email" placeholder="Email" required />
            <div style="display:flex; gap:8px; align-items:center;">
              <input name="password" id="login-password" type="password" placeholder="Mot de passe" required />
              <button type="button" class="toggle-pass ghost" data-target="#login-password" aria-pressed="false">Afficher</button>
            </div>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button type="submit">Connexion</button>
              <button type="button" id="btn-demo-login" class="ghost">Demo login</button>
            </div>
            <div id="login-msg" class="muted small" role="status" aria-live="polite"></div>
          </form>
        </div>
      </div>
      <div class="muted-note">Astuce: utilisez les boutons "Demo" pour remplir rapidement les formulaires en environnement de test.</div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden" aria-hidden="true">
      <div class="card" aria-live="polite">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h3>Mes familles</h3>
            <div class="muted small">Créer une famille ou sélectionnez-en une pour gérer événements & tâches</div>
          </div>

          <div style="min-width:320px;">
            <form id="form-create-family" style="display:flex; gap:8px; align-items:center;" aria-label="Créer une nouvelle famille">
              <input name="name" placeholder="Nom famille" required />
              <input name="slug" placeholder="slug-unique" required pattern="^[a-z0-9-]+$" title="Utilisez lettres minuscules, chiffres et tirets" />
              <button type="submit">Créer</button>
            </form>
            <div id="family-create-msg" class="muted small"></div>
          </div>
        </div>

        <div id="families-list" style="margin-top:12px;"></div>
      </div>

      <div id="family-panel" class="card hidden" aria-hidden="true">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <h3 id="family-title"></h3>
            <div id="family-meta" class="muted small"></div>
          </div>

          <div style="min-width:320px;">
            <form id="form-invite" style="display:flex; gap:8px; align-items:center;" aria-label="Inviter un membre par email">
              <input name="email" type="email" placeholder="Inviter (email)" required />
              <button type="submit">Inviter</button>
            </form>
            <div id="invite-msg" class="muted small"></div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <strong>Membres</strong>
          <div id="members-list" class="muted small" style="margin-top:8px;"></div>
        </div>

        <div style="margin-top:12px;" class="grid-3">
          <div>
            <h4>Événements</h4>
            <form id="form-create-event" aria-label="Ajouter un événement">
              <input name="title" placeholder="Titre" required />
              <div class="form-row">
                <input name="date" type="date" required />
                <input name="time" type="time" />
              </div>
              <textarea name="description" placeholder="Description" rows="2"></textarea>
              <div style="margin-top:6px;"><button type="submit">Ajouter événement</button></div>
            </form>
            <div id="events-list" style="margin-top:8px;"></div>
          </div>

          <div>
            <h4>Tâches</h4>
            <form id="form-create-task" aria-label="Ajouter une tâche">
              <input name="title" placeholder="Titre" required />
              <div class="form-row">
                <input name="dueDate" type="date" />
                <select name="priority">
                  <option value="">Priorité</option>
                  <option value="low">Faible</option>
                  <option value="medium">Moyenne</option>
                  <option value="high">Haute</option>
                </select>
              </div>
              <textarea name="description" placeholder="Description" rows="2"></textarea>
              <div style="margin-top:6px;"><button type="submit">Ajouter tâche</button></div>
            </form>
            <div id="tasks-list" style="margin-top:8px;"></div>
          </div>

          <div>
            <h4>Invitations</h4>
            <div class="muted small">Envoyer et accepter des invitations. Les tokens peuvent être copiés pour partage.</div>
            <div id="invites-list" style="margin-top:8px;"></div>

            <div style="margin-top:8px;">
              <div class="muted small">Si vous avez reçu un lien d'invitation, collez ici :</div>
              <form id="form-accept-invite" style="display:flex; gap:8px; margin-top:6px;" aria-label="Accepter une invitation par token">
                <input name="token" placeholder="token d'invitation" />
                <button type="submit">Accepter</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div id="info" class="muted small" style="margin-top:8px;"></div>
    </div>

    <footer class="muted small">
      Prototype local — API attendue sur http://localhost:4000
    </footer>
  </div>

  <!-- Toast + Modal -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <div id="modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div id="modal-content"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="modal-cancel" class="ghost">Annuler</button>
        <button id="modal-confirm" class="danger">Confirmer</button>
      </div>
    </div>
  </div>

  <script>
    /* Enhanced frontend JS: structured state, robust error handling, edit/delete actions,
       optimistic updates, accessible toasts and modal confirmation dialogs.
       The API endpoints used are the same as the backend primer; non-implemented endpoints are handled gracefully.
    */

    const API_BASE = "http://localhost:4000/api";

    // Application state
    const state = {
      user: null,
      families: [],
      currentFamilyId: null,
      events: [],
      tasks: [],
      invites: []
    };

    // ---- Helpers ----
    function $(sel) { return document.querySelector(sel); }
    function $all(sel) { return Array.from(document.querySelectorAll(sel)); }
    function show(el){ if(!el) return; el.classList.remove('hidden'); el.setAttribute('aria-hidden','false'); }
    function hide(el){ if(!el) return; el.classList.add('hidden'); el.setAttribute('aria-hidden','true'); }
    function isVisible(el){ return el && !el.classList.contains('hidden'); }

    function showToast(msg, opts = {}) {
      const t = $('#toast');
      t.textContent = msg;
      t.style.display = 'block';
      if (opts.success) t.style.background = '#0f172a';
      setTimeout(() => { t.style.display = 'none'; }, opts.duration || 4000);
    }

    // Modal: returns a promise that resolves true if confirmed
    function showModal({ title = 'Confirmer', message = '', confirmText = 'Confirmer', cancelText = 'Annuler' } = {}) {
      return new Promise(resolve => {
        const backdrop = $('#modal-backdrop');
        const content = $('#modal-content');
        $('#modal-confirm').textContent = confirmText;
        $('#modal-cancel').textContent = cancelText;
        content.innerHTML = `<strong>${escapeHtml(title)}</strong><div style="margin-top:8px;">${escapeHtml(message)}</div>`;
        backdrop.style.display = 'flex';
        backdrop.setAttribute('aria-hidden','false');

        function cleanup(result){
          backdrop.style.display = 'none';
          backdrop.setAttribute('aria-hidden','true');
          $('#modal-confirm').removeEventListener('click', onConfirm);
          $('#modal-cancel').removeEventListener('click', onCancel);
          resolve(result);
        }
        function onConfirm(){ cleanup(true); }
        function onCancel(){ cleanup(false); }
        $('#modal-confirm').addEventListener('click', onConfirm);
        $('#modal-cancel').addEventListener('click', onCancel);
      });
    }

    function escapeHtml(s) {
      if (!s && s !== 0) return '';
      return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
    }

    function setToken(token) {
      if (token) localStorage.setItem('nesti_token', token);
      else localStorage.removeItem('nesti_token');
      refreshUI();
    }
    function getToken() { return localStorage.getItem('nesti_token'); }

    // Centralized fetch wrapper with JSON parsing + error normalization
    async function apiFetch(path, { method = 'GET', body = null, headers = {} } = {}) {
      headers['Content-Type'] = 'application/json';
      const token = getToken();
      if (token) headers['Authorization'] = 'Bearer ' + token;
      const opts = { method, headers };
      if (body) opts.body = typeof body === 'string' ? body : JSON.stringify(body);

      let res;
      try {
        res = await fetch(API_BASE + path, opts);
      } catch (err) {
        throw { error: 'Impossible de joindre le serveur', detail: err.message || err };
      }

      let json = null;
      try { json = await res.json(); } catch(e){ json = null; }
      if (!res.ok) {
        // unify error shape
        const message = (json && (json.error || json.message)) || `Erreur ${res.status}`;
        throw { error: message, status: res.status, detail: json };
      }
      return json;
    }

    // ---- Rendering ----

    function renderAuthArea() {
      const token = getToken();
      if (!token) {
        show($('#not-logged')); hide($('#logged')); hide($('#dashboard')); hide($('#auth-card'));
        return;
      }
      hide($('#not-logged')); show($('#logged')); show($('#dashboard'));
      // decode token for quick display
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        $('#user-name').textContent = payload.email || payload.name || 'Utilisateur';
      } catch(e) { $('#user-name').textContent = 'Utilisateur'; }
    }

    function renderFamiliesList() {
      const el = $('#families-list');
      el.innerHTML = '';
      if (!state.families.length) {
        el.innerHTML = '<div class="muted small">Aucune famille. Créez-en une.</div>';
        return;
      }
      state.families.forEach(f => {
        const active = f.id === state.currentFamilyId ? 'box-shadow:0 4px 14px rgba(43,108,176,.06);' : '';
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `
          <div class="list-main">
            <strong>${escapeHtml(f.name)}</strong>
            <div class="meta">slug: ${escapeHtml(f.slug)} • membres: ${f.members?.length ?? 0}</div>
          </div>
          <div class="controls" style="${active}">
            <button class="ghost btn-open" data-id="${f.id}">Ouvrir</button>
            <button class="ghost btn-rename" data-id="${f.id}">Renommer</button>
            <button class="danger btn-delete" data-id="${f.id}">Supprimer</button>
          </div>`;
        el.appendChild(div);
      });
    }

    function renderFamilyPanel() {
      const family = state.families.find(f => f.id === state.currentFamilyId);
      if (!family) { hide($('#family-panel')); return; }
      show($('#family-panel'));
      $('#family-title').textContent = family.name;
      $('#family-meta').textContent = `slug: ${family.slug} — créée: ${new Date(family.createdAt).toLocaleString()}`;
      // members
      const membersEl = $('#members-list');
      membersEl.innerHTML = family.members.map(m => {
        const role = escapeHtml(m.role || 'member');
        const email = escapeHtml(m.user.email);
        return `<div style="display:flex;justify-content:space-between;gap:8px;align-items:center;">
                  <div><strong>${email}</strong><div class="meta">${role}</div></div>
                  <div class="controls">
                    <button class="ghost btn-change-role" data-user="${m.userId}" data-family="${family.id}">Role</button>
                    <button class="ghost btn-remove-member" data-user="${m.userId}" data-family="${family.id}">Retirer</button>
                  </div>
                </div>`;
      }).join('');
      renderEvents();
      renderTasks();
      renderInvites();
    }

    function renderEvents() {
      const el = $('#events-list');
      const events = state.events || [];
      if (!events.length) { el.innerHTML = '<div class="muted small">Aucun événement</div>'; return; }
      el.innerHTML = events.map(ev => `
        <div class="list-item">
          <div class="list-main">
            <strong>${escapeHtml(ev.title)}</strong>
            <div class="meta">${new Date(ev.date).toLocaleDateString()} ${ev.time || ''}</div>
            <div class="small">${escapeHtml(ev.description || '')}</div>
          </div>
          <div class="controls">
            <button class="ghost btn-edit-event" data-id="${ev.id}">Modifier</button>
            <button class="danger btn-delete-event" data-id="${ev.id}">Supprimer</button>
          </div>
        </div>`).join('');
    }

    function renderTasks() {
      const el = $('#tasks-list');
      const tasks = state.tasks || [];
      if (!tasks.length) { el.innerHTML = '<div class="muted small">Aucune tâche</div>'; return; }
      el.innerHTML = tasks.map(t => `
        <div class="list-item">
          <div class="list-main">
            <div style="display:flex;gap:8px;align-items:center;">
              <input type="checkbox" class="task-done" data-id="${t.id}" ${t.done ? 'checked' : ''} />
              <strong style="${t.done ? 'text-decoration:line-through;color:var(--muted)' : ''}">${escapeHtml(t.title)}</strong>
            </div>
            <div class="meta">${t.priority ? 'Priorité: ' + escapeHtml(t.priority) : ''} ${t.dueDate ? '• ' + new Date(t.dueDate).toLocaleDateString() : ''}</div>
            <div class="small">${escapeHtml(t.description || '')}</div>
          </div>
          <div class="controls">
            <button class="ghost btn-edit-task" data-id="${t.id}">Modifier</button>
            <button class="danger btn-delete-task" data-id="${t.id}">Supprimer</button>
          </div>
        </div>`).join('');
    }

    function renderInvites() {
      const el = $('#invites-list');
      const invites = state.invites || [];
      if (!invites.length) {
        el.innerHTML = '<div class="muted small">Aucune invitation</div>';
        return;
      }
      // show token + copy
      el.innerHTML = invites.map(i => `
        <div class="list-item">
          <div class="list-main">
            <strong>${escapeHtml(i.email)}</strong>
            <div class="meta">token: <span class="small">${escapeHtml(i.token)}</span> • accepted: ${i.accepted}</div>
            <div class="small">exp: ${new Date(i.expiresAt).toLocaleString()}</div>
          </div>
          <div class="controls">
            <button class="ghost btn-copy-token" data-token="${escapeHtml(i.token)}">Copier</button>
            <button class="ghost btn-resend-invite" data-id="${i.id}">Renvoyer</button>
            <button class="danger btn-cancel-invite" data-id="${i.id}">Annuler</button>
          </div>
        </div>`).join('');
    }

    // ---- Actions / API calls ----

    async function refreshState() {
      // load families and select current
      try {
        const families = await apiFetch('/families');
        state.families = families;
        if (!state.currentFamilyId && families.length) state.currentFamilyId = families[0].id;
        renderFamiliesList();
        renderFamilyPanel();
      } catch (err) {
        // if unauthorized, clear token
        if (err.status === 401) { setToken(null); showToast('Session expirée'); }
        else console.warn(err);
      }
    }

    async function loadFamilyDetails(familyId) {
      try {
        // families endpoint returns members included by primer; events/tasks need separate calls
        const families = await apiFetch('/families');
        state.families = families;
        const family = families.find(f => f.id === familyId);
        state.currentFamilyId = familyId;
        // load events/tasks/invites
        try { state.events = await apiFetch(`/families/${familyId}/events`); } catch(e){ state.events = []; }
        try { state.tasks = await apiFetch(`/families/${familyId}/tasks`); } catch(e){ state.tasks = []; }
        try { state.invites = await apiFetch(`/families/${familyId}/invitations`); } catch(e){ state.invites = []; }
        renderFamiliesList();
        renderFamilyPanel();
      } catch (err) {
        console.warn(err);
        showToast(err.error || 'Erreur lors du chargement de la famille');
      }
    }

    // Register & Login
    async function handleRegister(form) {
      const data = { email: form.email.value.trim(), password: form.password.value, name: form.name.value.trim() || null };
      if (data.password.length < 8) { $('#reg-msg').textContent = 'Mot de passe trop court (min 8)'; return; }
      $('#reg-msg').textContent = 'Inscription en cours...';
      try {
        const res = await apiFetch('/auth/register', { method: 'POST', body: data });
        setToken(res.token);
        $('#reg-msg').textContent = 'Inscription réussie';
        await refreshState();
      } catch (err) {
        $('#reg-msg').textContent = err.error || 'Erreur inscription';
      }
    }

    async function handleLogin(form) {
      const data = { email: form.email.value.trim(), password: form.password.value };
      $('#login-msg').textContent = 'Connexion...';
      try {
        const res = await apiFetch('/auth/login', { method: 'POST', body: data });
        setToken(res.token);
        $('#login-msg').textContent = 'Connecté';
        await refreshState();
      } catch (err) {
        $('#login-msg').textContent = err.error || 'Erreur connexion';
      }
    }

    // Family create / rename / delete
    async function createFamily(data, form) {
      try {
        const f = await apiFetch('/families', { method: 'POST', body: data });
        showToast('Famille créée', { success:true });
        form.reset();
        await refreshState();
        state.currentFamilyId = f.id;
        await loadFamilyDetails(f.id);
      } catch (err) {
        $('#family-create-msg').textContent = err.error || 'Erreur création';
      }
    }

    async function renameFamily(familyId) {
      const family = state.families.find(f => f.id === familyId);
      const result = prompt('Nouveau nom pour la famille', family.name);
      if (!result) return;
      try {
        // backend primer doesn't have PATCH family endpoint; attempt and handle failure gracefully
        await apiFetch(`/families/${familyId}`, { method: 'PATCH', body: { name: result } });
        showToast('Famille renommée');
        await refreshState();
      } catch (err) {
        showToast('Renommer non disponible sur le backend', { duration:3000 });
      }
    }

    async function deleteFamily(familyId) {
      const ok = await showModal({ title: 'Supprimer la famille', message: 'Confirmez la suppression de cette famille (irréversible)', confirmText: 'Supprimer' });
      if (!ok) return;
      try {
        await apiFetch(`/families/${familyId}`, { method: 'DELETE' });
        showToast('Famille supprimée');
        if (state.currentFamilyId === familyId) state.currentFamilyId = null;
        await refreshState();
      } catch (err) {
        showToast('Suppression non disponible sur le backend', { duration:3000 });
      }
    }

    // Invite
    async function inviteMember(familyId, email, form) {
      try {
        const res = await apiFetch(`/families/${familyId}/invite`, { method: 'POST', body: { email } });
        showToast('Invitation créée');
        form.reset();
        // try to refresh invites list
        try { state.invites = await apiFetch(`/families/${familyId}/invitations`); } catch(e){ /* ignore */ }
        renderInvites();
      } catch (err) {
        showToast(err.error || 'Erreur invitation');
      }
    }

    // Accept invite
    async function acceptInvite(token, form) {
      try {
        await apiFetch('/invitations/accept', { method: 'POST', body: { token } });
        showToast('Invitation acceptée');
        form.reset();
        await refreshState();
      } catch (err) {
        showToast(err.error || 'Erreur acceptation');
      }
    }

    // Events CRUD
    async function createEvent(familyId, data, form) {
      try {
        const e = await apiFetch(`/families/${familyId}/events`, { method: 'POST', body: data });
        showToast('Événement ajouté');
        form.reset();
        state.events.unshift(e);
        renderEvents();
      } catch (err) {
        showToast(err.error || 'Erreur événement');
      }
    }

    async function editEvent(eventId) {
      const ev = state.events.find(x => x.id === eventId);
      if (!ev) return;
      const title = prompt('Titre', ev.title); if (!title) return;
      const date = prompt('Date (YYYY-MM-DD)', new Date(ev.date).toISOString().slice(0,10));
      try {
        await apiFetch(`/families/${ev.familyId}/events/${eventId}`, { method: 'PATCH', body: { title, date } });
        showToast('Modification essayée');
        await loadFamilyDetails(ev.familyId);
      } catch(e){
        showToast('Modification non disponible sur le backend', { duration:3000 });
      }
    }

    async function deleteEvent(eventId) {
      const ev = state.events.find(x => x.id === eventId);
      if (!ev) return;
      const ok = await showModal({ title: 'Supprimer événement', message: `Supprimer "${ev.title}" ?`, confirmText: 'Supprimer' });
      if (!ok) return;
      try {
        await apiFetch(`/families/${ev.familyId}/events/${eventId}`, { method: 'DELETE' });
        showToast('Événement supprimé');
        state.events = state.events.filter(x => x.id !== eventId);
        renderEvents();
      } catch(e){
        showToast('Suppression non disponible sur le backend', { duration:3000 });
      }
    }

    // Tasks CRUD
    async function createTask(familyId, data, form) {
      try {
        const t = await apiFetch(`/families/${familyId}/tasks`, { method: 'POST', body: data });
        showToast('Tâche ajoutée');
        form.reset();
        state.tasks.unshift(t);
        renderTasks();
      } catch (err) {
        showToast(err.error || 'Erreur tâche');
      }
    }

    async function editTask(taskId) {
      const t = state.tasks.find(x => x.id === taskId);
      if (!t) return;
      const title = prompt('Titre', t.title); if (!title) return;
      try {
        await apiFetch(`/families/${t.familyId}/tasks/${taskId}`, { method: 'PATCH', body: { title } });
        showToast('Modification essayée');
        await loadFamilyDetails(t.familyId);
      } catch(e){
        showToast('Modification non disponible sur le backend', { duration:3000 });
      }
    }

    async function deleteTask(taskId) {
      const t = state.tasks.find(x => x.id === taskId);
      if (!t) return;
      const ok = await showModal({ title: 'Supprimer tâche', message: `Supprimer "${t.title}" ?`, confirmText: 'Supprimer' });
      if (!ok) return;
      try {
        await apiFetch(`/families/${t.familyId}/tasks/${taskId}`, { method: 'DELETE' });
        showToast('Tâche supprimée');
        state.tasks = state.tasks.filter(x => x.id !== taskId);
        renderTasks();
      } catch(e){
        showToast('Suppression non disponible sur le backend', { duration:3000 });
      }
    }

    // Toggle task done (optimistic)
    async function toggleTaskDone(taskId, checked) {
      const t = state.tasks.find(x => x.id === taskId);
      if (!t) return;
      const prev = t.done;
      t.done = checked;
      renderTasks();
      try {
        await apiFetch(`/families/${t.familyId}/tasks/${taskId}`, { method: 'PATCH', body: { done: checked } });
      } catch (e) {
        t.done = prev; renderTasks();
        showToast('Mise à jour non disponible sur le backend', { duration:2000 });
      }
    }

    // Invite helpers (copy/resend/cancel)
    function copyToClipboard(text) {
      navigator.clipboard?.writeText(text).then(()=> showToast('Copié dans le presse-papiers'));
    }

    async function resendInvite(inviteId) {
      try {
        await apiFetch(`/invitations/${inviteId}/resend`, { method: 'POST' });
        showToast('Invitation renvoyée');
      } catch(e) {
        showToast('Renvoyer non disponible sur le backend');
      }
    }

    async function cancelInvite(inviteId) {
      const ok = await showModal({ title:'Annuler invitation', message:'Voulez-vous annuler cette invitation ?', confirmText: 'Annuler' });
      if (!ok) return;
      try {
        await apiFetch(`/invitations/${inviteId}`, { method: 'DELETE' });
        showToast('Invitation annulée');
        state.invites = state.invites.filter(i => i.id !== inviteId);
        renderInvites();
      } catch(e){
        showToast('Annulation non disponible sur le backend');
      }
    }

    // ---- Event Delegation & Listeners ----
    document.addEventListener('click', async (e) => {
      const target = e.target;
      // family actions
      if (target.matches('.btn-open')) {
        const id = Number(target.dataset.id);
        await loadFamilyDetails(id);
      } else if (target.matches('.btn-rename')) {
        const id = Number(target.dataset.id);
        await renameFamily(id);
      } else if (target.matches('.btn-delete')) {
        const id = Number(target.dataset.id);
        await deleteFamily(id);
      }

      // invite list
      else if (target.matches('.btn-copy-token')) {
        const token = target.dataset.token;
        copyToClipboard(token);
      } else if (target.matches('.btn-resend-invite')) {
        const id = Number(target.dataset.id);
        await resendInvite(id);
      } else if (target.matches('.btn-cancel-invite')) {
        const id = Number(target.dataset.id);
        await cancelInvite(id);
      }

      // events
      else if (target.matches('.btn-edit-event')) {
        const id = Number(target.dataset.id);
        await editEvent(id);
      } else if (target.matches('.btn-delete-event')) {
        const id = Number(target.dataset.id);
        await deleteEvent(id);
      }

      // tasks
      else if (target.matches('.btn-edit-task')) {
        const id = Number(target.dataset.id);
        await editTask(id);
      } else if (target.matches('.btn-delete-task')) {
        const id = Number(target.dataset.id);
        await deleteTask(id);
      } else if (target.matches('.task-done')) {
        const id = Number(target.dataset.id);
        toggleTaskDone(id, target.checked);
      }

      // members
      else if (target.matches('.btn-change-role')) {
        const userId = Number(target.dataset.user);
        const familyId = Number(target.dataset.family);
        const newRole = prompt('Nouveau rôle (owner, admin, member)', 'member');
        if (!newRole) return;
        try {
          await apiFetch(`/families/${familyId}/members/${userId}/role`, { method: 'PATCH', body: { role: newRole } });
          showToast('Rôle mis à jour');
          await loadFamilyDetails(familyId);
        } catch(e){ showToast('Modification non disponible sur le backend'); }
      } else if (target.matches('.btn-remove-member')) {
        const userId = Number(target.dataset.user);
        const familyId = Number(target.dataset.family);
        const conf = await showModal({ title: 'Retirer membre', message: 'Confirmer le retrait du membre ?' });
        if (!conf) return;
        try {
          await apiFetch(`/families/${familyId}/members/${userId}`, { method: 'DELETE' });
          showToast('Membre retiré');
          await loadFamilyDetails(familyId);
        } catch(e){ showToast('Retirer non disponible sur le backend'); }
      }
    });

    // Toggle password visibility
    document.addEventListener('click', (e) => {
      if (e.target.matches('.toggle-pass')) {
        const btn = e.target;
        const target = document.querySelector(btn.dataset.target);
        if (!target) return;
        const shown = target.type === 'text';
        target.type = shown ? 'password' : 'text';
        btn.textContent = shown ? 'Afficher' : 'Masquer';
        btn.setAttribute('aria-pressed', (!shown).toString());
      }
    });

    // Form listeners
    document.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      // register
      if (form.id === 'form-register') {
        await handleRegister(form);
      } else if (form.id === 'form-login') {
        await handleLogin(form);
      } else if (form.id === 'form-create-family') {
        const data = { name: form.name.value.trim(), slug: form.slug.value.trim() };
        const valid = form.slug.checkValidity();
        if (!valid) { $('#family-create-msg').textContent = form.slug.title; return; }
        await createFamily(data, form);
      } else if (form.id === 'form-invite') {
        const email = form.email.value.trim();
        const familyId = state.currentFamilyId;
        if (!familyId) { showToast('Sélectionnez une famille'); return; }
        await inviteMember(familyId, email, form);
      } else if (form.id === 'form-accept-invite') {
        const token = form.token.value.trim();
        if (!token) { showToast('Fournir un token'); return; }
        await acceptInvite(token, form);
      } else if (form.id === 'form-create-event') {
        const familyId = state.currentFamilyId;
        if (!familyId) { showToast('Sélectionnez une famille'); return; }
        const data = {
          title: form.title.value.trim(),
          description: form.description.value.trim(),
          date: form.date.value,
          time: form.time.value || null
        };
        await createEvent(familyId, data, form);
      } else if (form.id === 'form-create-task') {
        const familyId = state.currentFamilyId;
        if (!familyId) { showToast('Sélectionnez une famille'); return; }
        const data = {
          title: form.title.value.trim(),
          description: form.description.value.trim(),
          dueDate: form.dueDate.value || null,
          priority: form.priority.value || null
        };
        await createTask(familyId, data, form);
      }
    });

    // Misc UI interactions
    $('#btn-show-auth').addEventListener('click', () => {
      const authCard = $('#auth-card');
      authCard.classList.toggle('hidden');
      const expanded = authCard.classList.contains('hidden') ? 'false' : 'true';
      $('#btn-show-auth').setAttribute('aria-expanded', expanded);
    });
    $('#btn-logout').addEventListener('click', () => { setToken(null); showToast('Déconnecté'); });

    $('#btn-fill-demo').addEventListener('click', () => {
      const f = $('#form-register');
      f.email.value = `demo${Date.now()%10000}@example.com`;
      f.password.value = 'password123';
      f.name.value = 'Demo User';
    });
    $('#btn-demo-login').addEventListener('click', () => {
      const f = $('#form-login');
      f.email.value = 'demo@example.com';
      f.password.value = 'password';
    });

    // Initial load
    async function refreshUI() {
      const token = getToken();
      if (!token) {
        renderAuthArea();
        return;
      }
      // verify token by calling a protected endpoint
      try {
        await refreshState();
        renderAuthArea();
      } catch (err) {
        console.warn(err);
        setToken(null);
      }
    }

    // On page load: check URL token for invite
    document.addEventListener('DOMContentLoaded', async () => {
      await refreshUI();
      const params = new URLSearchParams(location.search);
      if (params.get('token')) {
        const token = params.get('token');
        $('#form-accept-invite').token.value = token;
        if (!getToken()) {
          // ask user to login / register first
          show($('#auth-card'));
        } else {
          try {
            await acceptInvite(token, $('#form-accept-invite'));
            showToast('Invitation acceptée via lien');
          } catch(e){ console.warn(e); }
        }
      }
    });
  </script>
</body>
</html>
